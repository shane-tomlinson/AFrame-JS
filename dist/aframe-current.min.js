if(!Function.prototype.bind){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e,c){var a=this.length;if(typeof e!="function"){throw new TypeError()}for(var b=0,d;d=this[b];++b){if(b in this){e.call(c,d,b,this)}}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=c<0?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){var a=function(c){return(c<10?"0":"")+c};var b=function(c){return(c<100?"0":"")+(c<10?"0":"")+c};return[this.getUTCFullYear(),"-",a(this.getUTCMonth()+1),"-",a(this.getUTCDate()),"T",a(this.getUTCHours()),":",a(this.getUTCMinutes()),":",a(this.getUTCSeconds()),".",b(this.getUTCMilliseconds()),"Z"].join("")}}if(!window.console){window.console=function(){}}var AFrame=(function(){var a={extend:function(e,g){var f=function(){};f.prototype=g.prototype;e.prototype=new f();e.prototype.constuctor=e;e.superclass=g.prototype;e.sc=g.prototype;var b=Array.prototype.slice.call(arguments,2);for(var c,d=0;c=b[d];++d){a.mixin(e.prototype,c)}},mixin:function(c,b){c=jQuery.extend(c,b)},construct:function(i){var j=i.type;var c=i.config||{};var d=i.plugins||[];var b;if(j){try{b=new j()}catch(h){console.log(h.toString())}for(var g=0,f;f=d[g];++g){var k=a.construct(f);k.setPlugged(b)}b.init(c)}else{throw"Class does not exist."}return b},remove:function(b,c){b[c]=null;delete b[c]},currentID:0,getUniqueID:function(){this.currentID++;return"cid"+this.currentID},defined:function(b){return"undefined"!=typeof(b)},func:function(b){return"function"==typeof(b)},string:function(b){return"[object String]"===Object.prototype.toString.apply(b)},array:function(b){return"[object Array]"===Object.prototype.toString.apply(b)}};return a}());AFrame.Observable=(function(){var a=function(){};a.getInstance=function(){return AFrame.construct({type:a})};a.prototype={init:function(){this.callbacks={}},teardown:function(){this.unbindAll()},trigger:function(){this.triggered=true;for(var b in this.callbacks){var c=this.callbacks[b];c.apply(this,arguments)}},bind:function(c){var b=AFrame.getUniqueID();this.callbacks[b]=c;return b},unbind:function(b){AFrame.remove(this.callbacks,b)},unbindAll:function(){for(var b in this.callbacks){AFrame.remove(this.callbacks,b)}},isTriggered:function(){return !!this.triggered}};return a}());AFrame.ObservablesMixin={triggerEvent:function(){var e=arguments[0];var d=!AFrame.string(e);var b=d?e.type:e;var f=this.events&&this.events[b];if(f){e=d?e:{type:e};this.setEventData(e);var a=this.getEventObject();var c=Array.prototype.slice.call(arguments,1);c.splice(0,0,a);f.trigger.apply(f,c);return a}},setEventData:function(b){if(!this.eventData){this.eventData=b}else{for(var a in b){this.eventData[a]=b[a]}}},getEventObject:function(){if(!this.eventData.target){this.eventData.target=this}var a=this.event||AFrame.Event.createEvent(this.eventData);this.eventData=null;this.event=null;return a},isEventTriggered:function(b){var a=false;var c=this.events&&this.events[b];if(c){a=c.isTriggered()}return a},bindEvent:function(b,e,c){this.events=this.events||{};var d=this.events[b]||AFrame.Observable.getInstance();this.events[b]=d;var a=d.bind(e.bind(c||this));this.bindings=this.bindings||{};this.bindings[a]={object:c,observable:d};if(c&&c.bindTo){c.bindTo(this,a)}return a},unbindEvent:function(b){var a=this.bindings&&this.bindings[b];if(a){AFrame.remove(this.bindings,b);if(a.object&&a.object.unbindTo){a.object.unbindTo(b)}return a.observable.unbind(b)}},unbindAll:function(){for(var a in this.events){this.events[a].unbindAll();AFrame.remove(this.events,a)}for(var c in this.bindings){var b=this.bindings[c];AFrame.remove(this.bindings,c);if(b.object&&b.object.unbindTo){b.object.unbindTo(c)}}},proxyEvents:function(b,a){a.forEach(function(c,d){b.bindEvent(c,function(){var e=Array.prototype.slice.call(arguments,1);this.event=arguments[0];this.event.originalTarget=this.event.target;this.event.target=this;e.splice(0,0,c);this.triggerEvent.apply(this,e)}.bind(this),this)},this)},bindTo:function(a,b){this.boundTo=this.boundTo||{};this.boundTo[b]=this.boundTo[b]||{object:a}},unbindTo:function(b){var a=this.boundTo[b];if(a){a.object.unbindEvent(b);AFrame.remove(this.boundTo,b)}},unbindToAll:function(){for(var b in this.boundTo){var a=this.boundTo[b];a.object.unbindEvent(b);AFrame.remove(this.boundTo,b)}this.boundTo=null;this.boundTo={}}};AFrame.EnumerableMixin=(function(){var a={filter:function(c){var b=[];this.forEach(function(d,e){if(true===c(d,e,this)){b.push(d)}},this);return b},search:function(b){return this.filter(b)[0]},getCount:function(){var b=0;this.forEach(function(c){b++});return b}};return a}());AFrame.AObject=(function(){var a=function(){};AFrame.mixin(a.prototype,{constructor:a,init:function(b){this.config=b;this.cid=b.cid||AFrame.getUniqueID();this.children={};this.bindEvents();this.triggerEvent("onInit")},getConfig:function(){return this.config},bindEvents:function(){},teardown:function(){this.triggerEvent("onTeardown");this.unbindAll();this.unbindToAll();this.teardownChildren();this.config=this.cid=this.children=null},teardownChildren:function(){for(var c in this.children){var b=this.children[c];b.teardown();AFrame.remove(this.children,c)}},getCID:function(){return this.cid},addChild:function(b){this.children[b.getCID()]=b},removeChild:function(b){AFrame.remove(this.children,b)}});AFrame.mixin(a.prototype,AFrame.ObservablesMixin);return a}());AFrame.DataContainer=(function(){var a=function(b){if(b instanceof a){return b}else{if(b){var c=b.__dataContainer;if(!c){c=AFrame.construct({type:a,config:{data:b}})}return c}}a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.AObject,AFrame.EnumerableMixin,{init:function(b){this.data=b.data||{};if(this.data.__dataContainer){throw Error("Cannot create a second DataContainer for an object")}this.data.__dataContainer=this;this.fieldBindings={};a.sc.init.apply(this,arguments)},set:function(d,c){var b=this.data[d];this.data[d]=c;this.triggerEvent({fieldName:d,oldValue:b,value:c,type:"onSet"});this.triggerEvent({fieldName:d,oldValue:b,value:c,type:"onSet-"+d});return b},get:function(b){return this.data[b]},getDataObject:function(){return this.data},bindField:function(e,d,b){this.setEventData({container:this,fieldName:e,oldValue:undefined,value:this.get(e),type:"onSet:"+e});var c=this.getEventObject();d.call(b,c);return this.bindEvent("onSet-"+e,d,b)},unbindField:function(b){return this.unbindEvent(b)},forEach:function(d,c){for(var b in this.data){if(b!=="__dataContainer"){d.call(c,this.data[b],b)}}}});return a}());AFrame.Plugin=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.AObject,{setPlugged:function(b){this.plugged=b;this.plugged.bindEvent("onTeardown",this.teardown,this)},getPlugged:function(){return this.plugged},teardown:function(){AFrame.remove(this,"plugged");a.sc.teardown.apply(this,arguments)}});return a}());AFrame.ArrayCommonFuncsMixin={getCount:function(){throw"operation not supported"},getActualInsertIndex:function(b){var a=this.getCount();if("undefined"==typeof(b)){b=a}else{if(b<0){b=a+(b+1)}}b=Math.max(0,b);b=Math.min(a,b);return b},getActualIndex:function(b){var a=this.getCount();if(b<0){b=a+b}b=Math.min(a-1,b);b=Math.max(0,b);return b}};AFrame.CollectionHash=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};a.currID=0;AFrame.extend(a,AFrame.AObject,AFrame.EnumerableMixin,{init:function(b){this.hash={};a.sc.init.apply(this,arguments)},teardown:function(){for(var b in this.hash){AFrame.remove(this.hash,b)}AFrame.remove(this,"hash");a.sc.teardown.apply(this,arguments)},get:function(b){return this.hash[b]},remove:function(e,b){var d=this.get(e);if(d){var c=this.triggerEvent({item:d,cid:e,type:"onBeforeRemove",force:b&&b.force});if(this.shouldDoAction(b,c)){AFrame.remove(this.hash,e);this.triggerEvent({item:d,cid:e,type:"onRemove",force:b&&b.force});return d}}},insert:function(d,b){var e=d.cid||AFrame.getUniqueID();if("undefined"!=typeof(this.get(e))){throw"duplicate cid"}var c=this.triggerEvent({item:d,cid:e,type:"onBeforeInsert",force:b&&b.force});if(this.shouldDoAction(b,c)){if(d instanceof Object){d.cid=e}this.hash[e]=d;this.triggerEvent({item:d,cid:e,type:"onInsert",force:b&&b.force});return e}},shouldDoAction:function(b,c){return(b&&b.force)||!(c&&c.isDefaultPrevented())},clear:function(){for(var b in this.hash){this.remove(b)}},forEach:function(e,b){var c=this.hash;for(var d in c){e.call(b,c[d],d)}}});return a})();AFrame.CollectionArray=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.CollectionHash,AFrame.ArrayCommonFuncsMixin,{init:function(){this.itemCIDs=[];a.sc.init.apply(this,arguments)},teardown:function(){this.itemCIDs.forEach(function(c,b){this.itemCIDs[b]=null},this);AFrame.remove(this,"itemCIDs");a.sc.teardown.apply(this,arguments)},insert:function(c,b){b="number"==typeof(b)?b:-1;this.currentIndex=this.getActualInsertIndex(b);var d=a.sc.insert.call(this,c);this.itemCIDs.splice(this.currentIndex,0,d);return d},get:function(c){var d=this.getCID(c);var b;if(d){b=a.sc.get.call(this,d)}return b},remove:function(c){var d;if("string"==typeof(c)){d=c;c=this.getIndex(c)}else{c=this.getActualIndex(c);d=this.getCID(c)}var b;if(c>-1){this.itemCIDs.splice(c,1);this.currentIndex=c;b=a.sc.remove.call(this,d)}return b},clear:function(){a.sc.clear.call(this);this.itemCIDs=[]},getCount:function(){return this.itemCIDs.length},getArray:function(){var b=[];this.itemCIDs.forEach(function(d,c){b[c]=this.hash.get(d)});return b},getEventObject:function(){var b=a.sc.getEventObject.call(this);b.index=this.currentIndex;return b},getCID:function(b){var c=b;if("number"==typeof(b)){b=this.getActualIndex(b);c=this.itemCIDs[b]}return c},getIndex:function(b){if("string"==typeof(b)){b=this.itemCIDs.indexOf(b)}return b},forEach:function(f,c){for(var d,b=0,e;e=this.itemCIDs[b];++b){d=this.get(e);f.call(c,d,b)}}});return a})();AFrame.Display=(function(){var a=0;var b=function(){b.sc.constructor.apply(this,arguments)};AFrame.extend(b,AFrame.AObject,{init:function(c){this.target=$(c.target);if(!this.target.length){throw"invalid target"}this.render();this.domEvents={};b.sc.init.call(this,c)},teardown:function(){for(var c in this.domEvents){this.unbindDOMEvent(c)}this.target=null;b.sc.teardown.call(this)},render:function(){this.triggerEvent("onRender",this)},getTarget:function(){return this.target},getDOMElement:function(){return this.target[0]},bindDOMEvent:function(g,c,i,d){var e=i.bind(d||this);var f=this.getEventTarget(g);f.bind(c,e);a++;var h=a;this.domEvents[h]={target:f,eventName:c,callback:e};return h},bindClick:function(d,e,c){return this.bindDOMEvent(d,"click",function(f){f.preventDefault();e.call(this,f)},c)},unbindDOMEvent:function(d){var c=this.domEvents[d];if(c){c.target.unbind(c.eventName,c.callback);c.target=null;c.eventName=null;c.callback=null;AFrame.remove(this.domEvents,d)}},getEventTarget:function(d){var c;if("string"==typeof(d)){c=$(d,this.getTarget())}else{c=$(d)}return c}});return b})();AFrame.List=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.Display,AFrame.ArrayCommonFuncsMixin,AFrame.EnumerableMixin,{init:function(b){if(b.listElementFactory){this.listElementFactory=b.listElementFactory}a.sc.init.apply(this,arguments)},clear:function(){this.getTarget().html("")},listElementFactory:function(){return $("<li />")},insert:function(d,b){b=this.getActualInsertIndex(b);var c=this.listElementFactory(d,b);b=this.insertElement(c,b);this.triggerEvent({rowElement:c,index:b,data:d,type:"onInsert"});return b},insertElement:function(e,c){var f=this.getTarget();var d=f.children();c=this.getActualInsertIndex(c);if(c===d.length){f.append(e)}else{var b=d.eq(c);e.insertBefore(b)}this.triggerEvent({rowElement:e,index:c,type:"onInsertElement"});return c},remove:function(b){var c=this.getActualIndex(b);var d=this.getTarget().children().eq(c).remove();this.triggerEvent({rowElement:d,index:b,type:"onRemoveElement"})},forEach:function(d,c){var b=this.getTarget().children();b.each(function(e,f){d.call(c,f,e)})}});return a})();AFrame.ListPluginBindToCollection=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.Plugin,{init:function(b){this.collection=b.collection;this.collection.bindEvent("onInsert",this.onInsert,this);this.collection.bindEvent("onRemove",this.onRemove,this);this.cids=[];a.sc.init.apply(this,arguments)},setPlugged:function(b){b.getIndex=this.getIndex.bind(this);a.sc.setPlugged.apply(this,arguments)},onInsert:function(c){var b=this.getPlugged().insert(c.item,c.index||-1);this.cids.splice(b,0,c.cid)},onRemove:function(c){var b=this.cids.indexOf(c.cid);this.getPlugged().remove(b);this.cids.splice(b,1)},getIndex:function(c){var b=c;if("string"==typeof(c)){b=this.cids.indexOf(c)}return b}});return a}());AFrame.CollectionPluginPersistence=(function(){var c=function(){c.sc.constructor.apply(this,arguments)};AFrame.extend(c,AFrame.Plugin,{init:function(e){this.addCallback=e.addCallback||d;this.saveCallback=e.saveCallback||d;this.loadCallback=e.loadCallback||d;this.deleteCallback=e.deleteCallback||d;c.sc.init.apply(this,arguments)},setPlugged:function(e){e.add=this.add.bind(this);e.load=this.load.bind(this);e.del=this.del.bind(this);e.save=this.save.bind(this);c.sc.setPlugged.apply(this,arguments)},add:function(h,e){e=b(this,e);var i=e.onComplete;var g=this.getPlugged();var f=g.triggerEvent(a("onBeforeAdd",h,e));if(g.shouldDoAction(e,f)){e.onComplete=function(){var j=g.insert(h,e.insertAt);e.cid=j;e.onComplete=i;i&&i(h,e);g.triggerEvent(a("onAdd",h,e))};this.addCallback(h,e)}},load:function(e){e=b(this,e);var g=this.getPlugged();var f=g.triggerEvent({type:"onBeforeLoad",force:e&&e.force});if(g.shouldDoAction(e,f)){var h=e.onComplete;g.triggerEvent({type:"onLoadStart",force:e&&e.force});e.onComplete=function(i){if(i){i.forEach(function(k,j){g.insert(k)})}e.onComplete=h;h&&h(i,e);g.triggerEvent({items:i,type:"onLoadComplete",force:e&&e.force})};this.loadCallback(e)}},del:function(i,e){var h=this.getPlugged();var g=h.get(i);if(g){var f=h.triggerEvent(a("onBeforeDelete",g,e));if(h.shouldDoAction(e,f)){e=b(this,e);var j=e.onComplete;e.onComplete=function(){h.remove(i,e);e.onComplete=j;j&&j(g,e)};this.deleteCallback(g,e);h.triggerEvent(a("onDelete",g,e))}}},save:function(i,e){var h=this.getPlugged();var g=h.get(i);if(g){var f=h.triggerEvent(a("onBeforeSave",g,e));if(h.shouldDoAction(e,f)){e=b(this,e);var j=e.onComplete;e.onComplete=function(){e.onComplete=j;j&&j(g,e)}.bind(this);this.saveCallback(g,e);h.triggerEvent(a("onSave",g,e))}}}});function b(f,e){e=e||{};e.collection=f.getPlugged();return e}function a(f,h,e){var g={type:f,item:h};if(h.cid){g.cid=h.cid}if(e&&e.force){g.force=true}return g}function d(f,e){var g=e.onComplete;g&&g(f,e)}return c})();AFrame.Form=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.Display,AFrame.EnumerableMixin,{init:function(b){this.formFieldFactory=b.formFieldFactory||this.formFieldFactory;this.formElements=[];this.formFields=[];a.sc.init.apply(this,arguments);this.bindFormElements()},formFieldFactory:function(b){return AFrame.construct({type:AFrame.Field,config:{target:b}})},bindFormElements:function(){var b=$("[data-field]",this.getTarget());b.each(function(c,d){this.bindFormElement(d)}.bind(this))},teardown:function(){this.forEach(function(c,b){c.teardown();this.formFields[b]=null},this);this.formFields=null;this.formElements=null;a.sc.teardown.apply(this,arguments)},bindFormElement:function(b){var d=$(b);this.formElements.push(d);var c=this.formFieldFactory(d);this.formFields.push(c);return c},getFormElements:function(){return this.formElements},getFormFields:function(){return this.formFields},checkValidity:function(){var c=true;for(var b=0,d;(d=this.formFields[b])&&c;++b){c=d.checkValidity()}return c},clear:function(){this.fieldAction("clear")},reset:function(){this.fieldAction("reset")},save:function(){var b=this.checkValidity();if(b){this.fieldAction("save")}return b},fieldAction:function(b){this.forEach(function(d,c){d[b]()})},forEach:function(c,b){this.formFields&&this.formFields.forEach(c,b)}});return a}());AFrame.Field=(function(){var a=function(){AFrame.Field.sc.constructor.apply(this,arguments)};a.cancelInvalid=true;AFrame.extend(a,AFrame.Display,{init:function(b){this.createValidator();a.sc.init.apply(this,arguments);this.resetVal=this.getDisplayed()},createValidator:function(){if(!this.validate){var b=AFrame.construct({type:AFrame.FieldPluginValidation});b.setPlugged(this)}},bindEvents:function(){var b=this.getTarget();this.bindDOMEvent(b,"keyup",this.onFieldChange,this);this.bindDOMEvent(b,"invalid",this.onFieldInvalid,this);a.sc.bindEvents.apply(this,arguments)},set:function(b){this.resetVal=b;this.display(b);this.onFieldChange()},display:function(c){var b=this.getTarget();if(this.isValBased(b)){b.val(c)}else{b.html(c)}},getDisplayed:function(){var c=this.getTarget();var b="";if(this.isValBased(c)){b=c.val()}else{b=c.html()}return b},reset:function(){this.set(this.resetVal)},clear:function(){this.set("")},get:function(){return this.resetVal},save:function(){var b=this.getDisplayed();this.resetVal=b},onFieldChange:function(){this.triggerEvent("onChange",this,this.get())},onFieldInvalid:function(b){if(a.cancelInvalid){b.preventDefault()}},isValBased:function(b){return b.is("input")||b.is("textarea")}});return a}());AFrame.FieldPluginValidation=(function(){var a=function(){a.sc.constructor.call(this)};AFrame.extend(a,AFrame.Plugin,{setPlugged:function(b){this.calculateValidity=true;b.bindEvent("onChange",this.onChange,this);b.getValidityState=this.getValidityState.bind(this);b.validate=this.validate.bind(this);b.setError=this.setError.bind(this);b.setCustomValidity=this.setCustomValidity.bind(this);b.checkValidity=this.checkValidity.bind(this);a.sc.setPlugged.call(this,b)},onChange:function(){this.calculateValidity=true},getValidityState:function(){this.updateValidityState(true);return this.validityState},checkValidity:function(){return this.validate()},validate:function(){this.updateValidityState();var d=this.getPlugged();var b=true;var c=d.getTarget();if(c[0].checkValidity){b=c[0].checkValidity()}else{var f=this.getCriteria();var e=d.get();e=e.length?e:undefined;AFrame.DataValidation.validate({data:e,criteria:f,fieldValidityState:this.validityState});b=this.validityState.valid}return b},updateValidityState:function(b){if(this.calculateValidity){this.validityState=AFrame.FieldValidityState.getInstance(this.getPlugged().getTarget()[0].validity);if(b){this.validate()}this.calculateValidity=false}},setError:function(b){this.updateValidityState(true);this.getPlugged().getTarget().trigger("invalid");return this.validityState.setError(b)},setCustomValidity:function(b){this.updateValidityState(true);this.getPlugged().getTarget().trigger("invalid");return this.validityState.setCustomValidity(b)},getCriteria:function(){var c=this.getPlugged().getTarget();var b=c.attr("type");if(!b||b=="textarea"){b="text"}var d={type:b};if(c.hasAttr("required")){d.required=true}if(c.hasAttr("min")){d.min=parseFloat(c.attr("min"))}if(c.hasAttr("max")){d.max=parseFloat(c.attr("max"))}if(c.hasAttr("step")){d.step=parseFloat(c.attr("step"))}if(c.hasAttr("maxlength")){d.maxlength=parseInt(c.attr("maxlength"),10)}if(c.hasAttr("pattern")){d.pattern=c.attr("pattern")}return d}});return a})();$.fn.hasAttr=function(a){var b=this[0].getAttribute(a);return b!==null};AFrame.FieldValidityState=function(a){if(a){AFrame.mixin(this,a)}};AFrame.FieldValidityState.getInstance=function(a){return new AFrame.FieldValidityState(a||{})};AFrame.FieldValidityState.prototype={valueMissing:false,typeMismatch:false,patternMismatch:false,tooLong:false,rangeUnderflow:false,rangeOverflow:false,stepMismatch:false,customError:false,valid:true,validationMessage:"",setError:function(a){this[a]=true;this.valid=false},setCustomValidity:function(a){if(a){this.valid=false;this.customError=true;this.validationMessage=a}}};AFrame.FieldPlaceholderDecorator={init:function(){var a=AFrame.Field.prototype;this.decorators={};this.decorate("init",this.decoratorInit);this.decorate("bindEvents",this.decoratorBindEvents);this.decorate("set",this.decoratorSet);this.decorate("save",this.decoratorSave);this.decorate("display",this.decoratorDisplay)},decorate:function(b,a){var c=AFrame.Field.prototype;this["_"+b]=c[b];c[b]=a},decoratorInit:function(a){AFrame.FieldPlaceholderDecorator._init.call(this,a);this.display(AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this))},decoratorBindEvents:function(){var a=this.getTarget();this.bindDOMEvent(a,"focus",AFrame.FieldPlaceholderDecorator.onFieldFocus,this);this.bindDOMEvent(a,"blur",AFrame.FieldPlaceholderDecorator.onFieldBlur,this);AFrame.FieldPlaceholderDecorator._bindEvents.call(this)},decoratorSet:function(a){a=a||AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this);AFrame.FieldPlaceholderDecorator._set.call(this,a)},decoratorDisplay:function(c){var b=this.getTarget();var a=c==AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this)?"addClass":"removeClass";b[a]("empty");AFrame.FieldPlaceholderDecorator._display.call(this,c)},decoratorSave:function(){var b=AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this);var a=this.getDisplayed()==b;if(a){this.display("")}AFrame.FieldPlaceholderDecorator._save.call(this);if(a){this.display(b)}},onFieldFocus:function(){if(this.getDisplayed()==AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this)){this.display("")}},onFieldBlur:function(){if(""===this.getDisplayed()){this.display(AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this))}},getPlaceholder:function(){var a=this.getTarget();return a.attr("placeholder")||""}};(function(){var a=document.createElement("input");if(!("placeholder" in a)){AFrame.FieldPlaceholderDecorator.init()}})();AFrame.Schema=(function(){var a="__SchemaID";Schema=function(b){if(b){if(!b[a]){b[a]=AFrame.getUniqueID();Schema.addSchemaConfig(b[a],b)}return Schema.getSchema(b[a])}else{Schema.sc.constructor.call(this)}};AFrame.extend(Schema,AFrame.AObject,{init:function(b){this.schema=b.schema;if(!b.schema){throw"Schema.js: Schema requires a schema configuration object"}Schema.sc.init.call(this,b)},getDefaults:function(){var b={};this.forEach(function(d,c){b[c]=this.getDefaultValue(c)},this);return b},getDefaultValue:function(b){var c=this.schema[b].def;if(AFrame.func(c)){c=c()}else{if(this.schema[b].has_many){c=[]}else{if(Schema.getSchema(this.schema[b].type)){c={}}}}return c},getAppData:function(b){var c={};this.forEach(function(e,d){var f=b[d];if(!AFrame.defined(f)){f=this.getDefaultValue(d)}if(e.has_many){f&&f.forEach&&f.forEach(function(h,g){f[g]=this.getAppDataValue(h,e,b,c)},this)}else{f=this.getAppDataValue(f,e,b,c)}c[d]=f},this);return c},getAppDataValue:function(e,d,g,h){var c=Schema.getSchema(d.type);if(c){e=c.getAppData(e)}else{if(AFrame.defined(e)){var f=Schema.deserializers[d.type];if(AFrame.func(f)){e=f(e)}}}var b=d.fixup;if(AFrame.func(b)){e=b({value:e,data:g,fixed:h})}return e},serializeItems:function(c){var b={};this.forEach(function(e,d){if(e.save!==false){var f=c[d];if(e.has_many){f&&f.forEach&&f.forEach(function(h,g){f[g]=this.getSerializedValue(h,e,c,b)},this)}else{f=this.getSerializedValue(f,e,c,b)}b[d]=f}},this);return b},getSerializedValue:function(g,f,e,c){var b=f.cleanup;if(AFrame.defined(b)){g=b({value:g,data:e,cleaned:c})}if(AFrame.defined(g)){var d=Schema.getSchema(f.type);if(d){g=d.serializeItems(g)}else{var h=Schema.serializers[f.type];if(AFrame.func(h)){g=h(g)}}}return g},forEach:function(e,c){for(var b in this.schema){if(b!==a){var d=this.schema[b];e.call(c,d,b)}}},validate:function(b,e){var d={};var c=false;this.forEach(function(k,h){var i=k.validate||{};var f=jQuery.extend({type:k.type},i);var j=b[h];if(!e||b.hasOwnProperty(h)){var g=this.validateData(b[h],f);if(g.valid){d[h]=true}else{d[h]=g;c=true}}},this);return c?d:true},validateData:function(b,c){return AFrame.DataValidation.validate({data:b,criteria:c})}});AFrame.mixin(Schema,{deserializers:{},serializers:{},schemaConfigs:{},schemaCache:{},addDeserializer:function(b,c){Schema.deserializers[b]=c},addSerializer:function(b,c){Schema.serializers[b]=c},addSchemaConfig:function(c,b){Schema.schemaConfigs[c]=b},getSchema:function(b){if(!Schema.schemaCache[b]&&Schema.schemaConfigs[b]){Schema.schemaCache[b]=AFrame.construct({type:Schema,config:{schema:Schema.schemaConfigs[b]}})}return Schema.schemaCache[b]}});Schema.addDeserializer("number",function(b){return parseFloat(b)});Schema.addDeserializer("integer",function(b){return parseInt(b,10)});Schema.addDeserializer("iso8601",function(h){try{var d=h.split("T"),j=d[0].split("-"),i=d[1].split("Z"),f=i[0].split(":"),b=f[2].split("."),c=Number(f[0]),k=new Date;k.setUTCFullYear(Number(j[0]));k.setUTCMonth(Number(j[1])-1);k.setUTCDate(Number(j[2]));k.setUTCHours(Number(c));k.setUTCMinutes(Number(f[1]));k.setUTCSeconds(Number(b[0]));if(b[1]){k.setUTCMilliseconds(Number(b[1]))}return k}catch(g){}});Schema.addSerializer("iso8601",function(b){return b.toISOString()});return Schema}());AFrame.ListPluginFormRow=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.Plugin,{init:function(b){this.formFactory=b.formFactory||this.formFactory;this.forms=[];a.sc.init.apply(this,arguments)},setPlugged:function(b){b.bindEvent("onInsert",this.onInsertRow,this);b.bindEvent("onRemove",this.onRemoveRow,this);b.validate=this.validate.bind(this);b.save=this.save.bind(this);b.reset=this.reset.bind(this);b.clear=this.clear.bind(this);b.getForm=this.getForm.bind(this);a.sc.setPlugged.apply(this,arguments)},teardown:function(){this.forms.forEach(function(c,b){c.teardown();this.forms[b]=null},this);a.sc.teardown.apply(this,arguments)},formFactory:function(c,d){var b=AFrame.construct({type:AFrame.DataForm,config:{target:c,dataSource:d}});return b},onInsertRow:function(d,b){var c=this.formFactory(d.rowElement,d);this.forms.splice(b,0,c)},onRemoveRow:function(d,b){var c=this.forms[b];c.teardown();this.forms[b]=null;this.forms.splice(b,1)},validate:function(b){var d=true;var c;if(AFrame.defined(b)){c=this.forms[b];if(c){d=c.validate()}}else{for(b=0;d&&(c=this.forms[b]);++b){d=c.validate()}}return d},save:function(b){this.formFunc(b,"save")},reset:function(b){this.formFunc(b,"reset")},clear:function(b){this.formFunc(b,"clear")},formFunc:function(b,d){if(AFrame.defined(b)){var c=this.forms[b];if(c){c[d]()}}else{this.forms.forEach(function(f,e){f[d]()})}},getForm:function(b){return this.forms[b]}});return a}());AFrame.DataForm=(function(){var b=function(){b.sc.constructor.apply(this,arguments)};AFrame.extend(b,AFrame.Form,{init:function(e){this.dataContainer=AFrame.DataContainer(e.dataSource);b.sc.init.apply(this,arguments)},teardown:function(){this.dataContainer=null;b.sc.teardown.apply(this,arguments)},bindFormElement:function(e){var f=b.sc.bindFormElement.apply(this,arguments);var g=c(f);this.dataContainer.bindField(g,a,f);return f},checkValidity:function(){var e=b.sc.checkValidity.call(this);if(e&&this.dataContainer.checkValidity){e=this.validateFormFieldsWithModels()}return e},validateFormFieldsWithModels:function(){var f=true;var e=this.getFormFields();e.forEach(function(i,g){var j=c(i);var h=this.dataContainer.checkValidity(j,i.get());if(h!==true){f=false;d(i,h)}},this);return f},save:function(){var f=b.sc.save.apply(this,arguments);if(f){var e=this.getFormFields();e.forEach(function(h,g){var i=c(h);this.dataContainer.set(i,h.get())},this)}return f}});function d(g,f){for(var e in f){if(f.hasOwnProperty(e)){var h=f[e];if(h===true){g.setError(e)}else{if("string"==typeof(h)){g.setCustomValidity(h)}}}}}function c(e){return e.getTarget().attr("data-field")}function a(e){this.set(e.value)}return b})();AFrame.DataValidation=(function(){var f=AFrame.defined;var a={};var g={text:"string",number:"number",integer:"number"};var e={validate:function(i){var h=i.data;var l=i.criteria;var m=i.fieldValidityState||AFrame.FieldValidityState.getInstance();var k=l.type||"text";for(var j in l){this.validateDataForTypeCriteria(h,k,j,m,l);this.validateDataForTypeCriteria(h,"all",j,m,l)}return m},validateDataForTypeCriteria:function(i,k,n,m,l){var h=a[k]||{};var j=h[n];if(j){j(i,m,l[n],l)}},setValidator:function(i,j,h){a[i]=a[i]||{};a[i][j]=h}};e.setValidator("all","required",function(h,i){if(!f(h)){i.setError("valueMissing")}});e.setValidator("all","type",function(h,k,j){if(f(h)){var i=g[j];if(i&&i!=typeof(h)){k.setError("typeMismatch")}}});var d=function(h,j,i){if(f(h)&&(h<i)){j.setError("rangeUnderflow")}};e.setValidator("number","min",d);e.setValidator("integer","min",d);var c=function(i,j,h){if(f(i)&&(i>h)){j.setError("rangeOverflow")}};e.setValidator("number","max",c);e.setValidator("integer","max",c);var b=function(h,m,k,l){if(f(h)){var i=l.min||0;var j=0===((h-i)%k);if(!j){m.setError("stepMismatch")}}};e.setValidator("number","step",b);e.setValidator("integer","step",b);e.setValidator("text","maxlength",function(i,j,h){if(f(i)&&i.length&&i.length>h){j.setError("tooLong")}});e.setValidator("text","pattern",function(h,k,j){var i=new RegExp(j);if(f(h)&&!i.test(h)){k.setError("patternMismatch")}});return e})();AFrame.Model=(function(){function c(){c.sc.constructor.call(this)}AFrame.extend(c,AFrame.DataContainer,{init:function(d){this.schema=b(d.schema);d.data=a(this.schema,d.data);c.sc.init.call(this,d)},set:function(f,e){var d=this.checkValidity(f,e);if(true===d){d=c.sc.set.call(this,f,e)}return d},checkValidity:function(g,f){var e={};e[g]=f;var d=this.schema.validate(e,true);if(d!==true){d=d[g]}return d},serializeItems:function(){var d=this.getDataObject();return this.schema.serializeItems(d)}});return c;function b(d){var e=d instanceof AFrame.Schema?d:AFrame.Schema(d);return e}function a(f,d){if(!d){d=f.getDefaults()}var g=f.getAppData(d);for(var e in g){d[e]=g[e]}return d}})();AFrame.Event=(function(){var a=function(){};a.prototype={constructor:a,init:function(b){for(var c in b){this[c]=b[c]}if(!this.type){throw"Event type undefined"}if(this.target){this.setOriginalTarget=true}this.timestamp=new Date()},isDefaultPrevented:function(){return !!this.defaultPrevented},preventDefault:function(){this.defaultPrevented=true},proxyEvent:function(b){if(this.setOriginalTarget){this.originalTarget=this.target;this.setOriginalTarget=false}this.target=b}};a.createEvent=function(b){var c=AFrame.construct({type:AFrame.Event,config:"string"==typeof(b)?{type:b}:b});return c};return a})();