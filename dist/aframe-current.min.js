if(!Function.prototype.bind){Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e,c){var a=this.length;if(typeof e!="function"){throw new TypeError()}for(var b=0,d;d=this[b];++b){if(b in this){e.call(c,d,b,this)}}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=c<0?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){var a=function(c){return(c<10?"0":"")+c};var b=function(c){return(c<100?"0":"")+(c<10?"0":"")+c};return[this.getUTCFullYear(),"-",a(this.getUTCMonth()+1),"-",a(this.getUTCDate()),"T",a(this.getUTCHours()),":",a(this.getUTCMinutes()),":",a(this.getUTCSeconds()),".",b(this.getUTCMilliseconds()),"Z"].join("")}}if(!window.console){window.console=function(){}}var AFrame={extend:function(d,f){var e=function(){};e.prototype=f.prototype;d.prototype=new e();d.prototype.constuctor=d;d.superclass=f.prototype;d.sc=f.prototype;var a=Array.prototype.slice.call(arguments,2);for(var b,c=0;b=a[c];++c){AFrame.mixin(d.prototype,b)}},mixin:function(b,a){b=jQuery.extend(b,a)},construct:function(h){var i=h.type;var b=h.config||{};var c=h.plugins||[];var a;if(i){try{a=new i()}catch(g){console.log(g.toString())}for(var f=0,d;d=c[f];++f){var j=AFrame.construct(d);j.setPlugged(a)}a.init(b)}else{throw"Class does not exist."}return a},remove:function(a,b){a[b]=null;delete a[b]},currentID:0,getUniqueID:function(){this.currentID++;return"cid"+this.currentID},defined:function(a){return"undefined"!=typeof(a)},func:function(a){return"function"==typeof(a)},string:function(a){return"[object String]"===Object.prototype.toString.apply(a)},array:function(a){return"[object Array]"===Object.prototype.toString.apply(a)}};AFrame.Observable=function(){};AFrame.Observable.getInstance=function(){return AFrame.construct({type:AFrame.Observable})};AFrame.Observable.prototype={init:function(){this.callbacks={}},teardown:function(){this.unbindAll()},trigger:function(){this.triggered=true;for(var a in this.callbacks){var b=this.callbacks[a];b.apply(this,arguments)}},bind:function(b){var a=AFrame.getUniqueID();this.callbacks[a]=b;return a},unbind:function(a){AFrame.remove(this.callbacks,a)},unbindAll:function(){for(var a in this.callbacks){AFrame.remove(this.callbacks,a)}},isTriggered:function(){return !!this.triggered}};AFrame.ObservablesMixin={triggerEvent:function(){var f=arguments[0];var e=!AFrame.string(f);var b=e?f.type:f;var d=this.events&&this.events[b];if(d){f=e?f:{type:f};this.setEventData(f);var a=this.getEventObject();var c=Array.prototype.slice.call(arguments,1);c.splice(0,0,a);d.trigger.apply(d,c)}},setEventData:function(b){if(!this.eventData){this.eventData=b}else{for(var a in b){this.eventData[a]=b[a]}}},getEventObject:function(){if(!this.eventData.target){this.eventData.target=this}var a=this.event||AFrame.Event.createEvent(this.eventData);this.eventData=null;this.event=null;return a},isEventTriggered:function(b){var a=false;var c=this.events&&this.events[b];if(c){a=c.isTriggered()}return a},bindEvent:function(b,e,c){this.events=this.events||{};var d=this.events[b]||AFrame.Observable.getInstance();this.events[b]=d;var a=d.bind(e.bind(c||this));this.bindings=this.bindings||{};this.bindings[a]={object:c,observable:d};if(c&&c.bindTo){c.bindTo(this,a)}return a},unbindEvent:function(b){var a=this.bindings&&this.bindings[b];if(a){AFrame.remove(this.bindings,b);if(a.object&&a.object.unbindTo){a.object.unbindTo(b)}return a.observable.unbind(b)}},unbindAll:function(){for(var a in this.events){this.events[a].unbindAll();AFrame.remove(this.events,a)}for(var c in this.bindings){var b=this.bindings[c];AFrame.remove(this.bindings,c);if(b.object&&b.object.unbindTo){b.object.unbindTo(c)}}},proxyEvents:function(b,a){a.forEach(function(c,d){b.bindEvent(c,function(){var e=Array.prototype.slice.call(arguments,1);this.event=arguments[0];this.event.originalTarget=this.event.target;this.event.target=this;e.splice(0,0,c);this.triggerEvent.apply(this,e)}.bind(this),this)},this)},bindTo:function(a,b){this.boundTo=this.boundTo||{};this.boundTo[b]=this.boundTo[b]||{object:a}},unbindTo:function(b){var a=this.boundTo[b];if(a){a.object.unbindEvent(b);AFrame.remove(this.boundTo,b)}},unbindToAll:function(){for(var b in this.boundTo){var a=this.boundTo[b];a.object.unbindEvent(b);AFrame.remove(this.boundTo,b)}this.boundTo=null;this.boundTo={}}};AFrame.AObject=function(){};AFrame.mixin(AFrame.AObject.prototype,{constructor:AFrame.AObject,init:function(a){this.config=a;this.cid=a.cid||AFrame.getUniqueID();this.children={};this.bindEvents();this.triggerEvent("onInit")},getConfig:function(){return this.config},bindEvents:function(){},teardown:function(){this.triggerEvent("onTeardown");this.unbindAll();this.unbindToAll();this.teardownChildren();this.config=this.cid=this.children=null},teardownChildren:function(){for(var b in this.children){var a=this.children[b];a.teardown();AFrame.remove(this.children,b)}},getCID:function(){return this.cid},addChild:function(a){this.children[a.getCID()]=a},removeChild:function(a){AFrame.remove(this.children,a)}});AFrame.mixin(AFrame.AObject.prototype,AFrame.ObservablesMixin);AFrame.DataContainer=function(a){if(a instanceof AFrame.DataContainer){return a}else{if(a){var b=a.__dataContainer;if(!b){b=AFrame.construct({type:AFrame.DataContainer,config:{data:a}})}return b}}AFrame.DataContainer.sc.constructor.apply(this,arguments)};AFrame.extend(AFrame.DataContainer,AFrame.AObject,{init:function(a){this.data=a.data||{};if(this.data.__dataContainer){throw Error("Cannot create a second AFrame.DataContainer for an object")}this.data.__dataContainer=this;this.fieldBindings={};AFrame.DataContainer.sc.init.apply(this,arguments)},set:function(c,b){var a=this.data[c];this.data[c]=b;this.triggerEvent({fieldName:c,oldValue:a,value:b,type:"onSet"});this.triggerEvent({fieldName:c,oldValue:a,value:b,type:"onSet-"+c});return a},get:function(a){return this.data[a]},bindField:function(d,c,a){this.setEventData({container:this,fieldName:d,oldValue:undefined,value:this.get(d),type:"onSet:"+d});var b=this.getEventObject();c.call(a,b);return this.bindEvent("onSet-"+d,c,a)},unbindField:function(a){return this.unbindEvent(a)},forEach:function(c,b){for(var a in this.data){if(a!=="__dataContainer"){c.call(b,this.data[a],a)}}}});AFrame.Plugin=function(){AFrame.Plugin.sc.constructor.apply(this,arguments)};AFrame.extend(AFrame.Plugin,AFrame.AObject,{setPlugged:function(a){this.plugged=a;this.plugged.bindEvent("onTeardown",this.teardown,this)},getPlugged:function(){return this.plugged},teardown:function(){AFrame.remove(this,"plugged");AFrame.Plugin.sc.teardown.apply(this,arguments)}});AFrame.ArrayCommonFuncsMixin={getCount:function(){throw"operation not supported"},getActualInsertIndex:function(b){var a=this.getCount();if("undefined"==typeof(b)){b=a}else{if(b<0){b=a+(b+1)}}b=Math.max(0,b);b=Math.min(a,b);return b},getActualIndex:function(b){var a=this.getCount();if(b<0){b=a+b}b=Math.min(a-1,b);b=Math.max(0,b);return b}};AFrame.CollectionHash=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};a.currID=0;AFrame.extend(a,AFrame.AObject,{init:function(b){this.hash={};a.sc.init.apply(this,arguments)},teardown:function(){for(var b in this.hash){AFrame.remove(this.hash,b)}AFrame.remove(this,"hash");a.sc.teardown.apply(this,arguments)},get:function(b){return this.hash[b]},remove:function(c){var b=this.get(c);if(b){this.triggerEvent({collection:this,item:b,cid:c,type:"onBeforeRemove"});AFrame.remove(this.hash,c);this.triggerEvent({collection:this,item:b,cid:c,type:"onRemove"})}return b},insert:function(b){var c=b.cid||AFrame.getUniqueID();if("undefined"!=typeof(this.get(c))){throw"duplicate cid"}if(b instanceof Object){b.cid=c}this.triggerEvent({collection:this,item:b,cid:c,type:"onBeforeInsert"});this.hash[c]=b;this.triggerEvent({collection:this,item:b,cid:c,type:"onInsert"});return c},clear:function(){for(var b in this.hash){this.remove(b)}},getCount:function(){var b=0;for(var c in this.hash){b++}return b},forEach:function(e,b){var c=this.hash;for(var d in c){e.call(b,c[d],d)}},filter:function(c){var b=[];this.forEach(function(d,e){if(true===c(d,e,this)){b.push(d)}},this);return b},search:function(b){return this.filter(b)[0]}});return a})();AFrame.CollectionArray=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.CollectionHash,AFrame.ArrayCommonFuncsMixin,{init:function(){this.itemCIDs=[];a.sc.init.apply(this,arguments)},teardown:function(){this.itemCIDs.forEach(function(c,b){this.itemCIDs[b]=null},this);AFrame.remove(this,"itemCIDs");a.sc.teardown.apply(this,arguments)},insert:function(c,b){b="number"==typeof(b)?b:-1;this.currentIndex=this.getActualInsertIndex(b);var d=a.sc.insert.call(this,c);this.itemCIDs.splice(this.currentIndex,0,d);return d},get:function(c){var d=this.getCID(c);var b;if(d){b=a.sc.get.call(this,d)}return b},remove:function(c){var d;if("string"==typeof(c)){d=c;c=this.getIndex(c)}else{c=this.getActualIndex(c);d=this.getCID(c)}var b;if(c>-1){this.itemCIDs.splice(c,1);this.currentIndex=c;b=a.sc.remove.call(this,d)}return b},clear:function(){a.sc.clear.call(this);this.itemCIDs=[]},getCount:function(){return this.itemCIDs.length},getArray:function(){var b=[];this.itemCIDs.forEach(function(d,c){b[c]=this.hash.get(d)});return b},getEventObject:function(){var b=a.sc.getEventObject.call(this);b.index=this.currentIndex;return b},getCID:function(b){var c=b;if("number"==typeof(b)){b=this.getActualIndex(b);c=this.itemCIDs[b]}return c},getIndex:function(b){if("string"==typeof(b)){b=this.itemCIDs.indexOf(b)}return b},forEach:function(f,c){for(var d,b=0,e;e=this.itemCIDs[b];++b){d=this.get(e);f.call(c,d,b)}}});return a})();AFrame.Display=(function(){var a=0;var b=function(){b.sc.constructor.apply(this,arguments)};AFrame.extend(b,AFrame.AObject,{init:function(c){this.target=$(c.target);if(!this.target.length){throw"invalid target"}this.render();this.domEvents={};b.sc.init.call(this,c)},teardown:function(){for(var c in this.domEvents){this.unbindDOMEvent(c)}this.target=null;b.sc.teardown.call(this)},render:function(){this.triggerEvent("onRender",this)},getTarget:function(){return this.target},getDOMElement:function(){return this.target[0]},bindDOMEvent:function(g,c,i,d){var e=i.bind(d||this);var f=this.getEventTarget(g);f.bind(c,e);a++;var h=a;this.domEvents[h]={target:f,eventName:c,callback:e};return h},bindClick:function(d,e,c){return this.bindDOMEvent(d,"click",function(f){f.preventDefault();e.call(this,f)},c)},unbindDOMEvent:function(d){var c=this.domEvents[d];if(c){c.target.unbind(c.eventName,c.callback);c.target=null;c.eventName=null;c.callback=null;AFrame.remove(this.domEvents,d)}},getEventTarget:function(d){var c;if("string"==typeof(d)){c=$(d,this.getTarget())}else{c=$(d)}return c}});return b})();AFrame.List=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.Display,AFrame.ArrayCommonFuncsMixin,{init:function(b){if(b.listElementFactory){this.listElementFactory=b.listElementFactory}a.sc.init.apply(this,arguments)},clear:function(){this.getTarget().html("")},listElementFactory:function(){return $("<li />")},insert:function(d,b){b=this.getActualInsertIndex(b);var c=this.listElementFactory(d,b);b=this.insertElement(c,b);this.triggerEvent({rowElement:c,index:b,data:d,type:"onInsert"});return b},insertElement:function(e,c){var f=this.getTarget();var d=f.children();c=this.getActualInsertIndex(c);if(c===d.length){f.append(e)}else{var b=d.eq(c);e.insertBefore(b)}this.triggerEvent({rowElement:e,index:c,type:"onInsertElement"});return c},remove:function(b){var c=this.getActualIndex(b);var d=this.getTarget().children().eq(c).remove();this.triggerEvent({rowElement:d,index:b,type:"onRemoveElement"})},getCount:function(){return this.getTarget().children().length}});return a})();AFrame.ListPluginBindToCollection=function(){AFrame.ListPluginBindToCollection.sc.constructor.apply(this,arguments)};AFrame.extend(AFrame.ListPluginBindToCollection,AFrame.Plugin,{init:function(a){this.collection=a.collection;this.collection.bindEvent("onInsert",this.onInsert,this);this.collection.bindEvent("onRemove",this.onRemove,this);this.cids=[];AFrame.ListPluginBindToCollection.sc.init.apply(this,arguments)},setPlugged:function(a){a.getIndex=this.getIndex.bind(this);AFrame.ListPluginBindToCollection.sc.setPlugged.apply(this,arguments)},onInsert:function(b){var a=this.getPlugged().insert(b.item,b.index||-1);this.cids.splice(a,0,b.cid)},onRemove:function(b){var a=this.cids.indexOf(b.cid);this.getPlugged().remove(a);this.cids.splice(a,1)},getIndex:function(b){var a=b;if("string"==typeof(b)){a=this.cids.indexOf(b)}return a}});AFrame.CollectionPluginPersistence=(function(){var a=function(){a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.Plugin,{init:function(b){this.addCallback=b.addCallback||this.noPersistenceOp;this.saveCallback=b.saveCallback||this.noPersistenceOp;this.loadCallback=b.loadCallback||this.noPersistenceOp;this.deleteCallback=b.deleteCallback||this.noPersistenceOp;a.sc.init.apply(this,arguments)},noPersistenceOp:function(c,b){var d=b.onComplete;d&&d(c,b)},setPlugged:function(b){b.add=this.add.bind(this);b.load=this.load.bind(this);b.del=this.del.bind(this);b.save=this.save.bind(this);a.sc.setPlugged.apply(this,arguments)},add:function(c,b){b=this.getOptions(b);var d=b.onComplete;b.onComplete=function(){var e=this.getPlugged().insert(c,b.insertAt);b.cid=e;b.onComplete=d;d&&d(c,b)}.bind(this);this.addCallback(c,b)},load:function(b){b=this.getOptions(b);var d=b.onComplete;var c=this.getPlugged();c.triggerEvent("onLoadStart");b.onComplete=function(e){if(e){e.forEach(function(g,f){c.insert(g)})}b.onComplete=d;d&&d(e,b);c.triggerEvent({items:e,type:"onLoadComplete"})}.bind(this);this.loadCallback(b)},del:function(e,b){var d=this.getPlugged();var c=d.get(e);if(c){b=this.getOptions(b);var f=b.onComplete;b.onComplete=function(){d.remove(e,b);b.onComplete=f;f&&f(c,b)}.bind(this);this.deleteCallback(c,b)}},save:function(d,b){var c=this.getPlugged().get(d);if(c){b=this.getOptions(b);var e=b.onComplete;b.onComplete=function(){b.onComplete=e;e&&e(c,b)}.bind(this);this.saveCallback(c,b)}},getOptions:function(b){b=b||{};b.collection=this.getPlugged();return b}});return a})();AFrame.Form=function(){AFrame.Form.sc.constructor.apply(this,arguments)};AFrame.extend(AFrame.Form,AFrame.Display,{init:function(a){this.formFieldFactory=a.formFieldFactory||this.formFieldFactory;this.formElements=[];this.formFields=[];AFrame.Form.sc.init.apply(this,arguments);this.bindFormElements()},formFieldFactory:function(a){return AFrame.construct({type:AFrame.Field,config:{target:a}})},bindFormElements:function(){var a=$("[data-field]",this.getTarget());a.each(function(b,c){this.bindFormElement(c)}.bind(this))},teardown:function(){this.formFields&&this.formFields.forEach(function(b,a){b.teardown();this.formFields[a]=null},this);this.formFields=null;this.formElements=null;AFrame.Form.sc.teardown.apply(this,arguments)},bindFormElement:function(a){var c=$(a);this.formElements.push(c);var b=this.formFieldFactory(c);this.formFields.push(b);return b},getFormElements:function(){return this.formElements},getFormFields:function(){return this.formFields},checkValidity:function(){var b=true;for(var a=0,c;(c=this.formFields[a])&&b;++a){b=c.checkValidity()}return b},clear:function(){this.fieldAction("clear")},reset:function(){this.fieldAction("reset")},save:function(){var a=this.checkValidity();if(a){this.fieldAction("save")}return a},fieldAction:function(a){this.formFields.forEach(function(c,b){c[a]()})}});AFrame.Field=function(){AFrame.Field.sc.constructor.apply(this,arguments)};AFrame.Field.cancelInvalid=true;AFrame.extend(AFrame.Field,AFrame.Display,{init:function(a){this.createValidator();AFrame.Field.sc.init.apply(this,arguments);this.resetVal=this.getDisplayed()},createValidator:function(){if(!this.validate){var a=AFrame.construct({type:AFrame.FieldPluginValidation});a.setPlugged(this)}},bindEvents:function(){var a=this.getTarget();this.bindDOMEvent(a,"keyup",this.onFieldChange,this);this.bindDOMEvent(a,"invalid",this.onFieldInvalid,this);AFrame.Field.sc.bindEvents.apply(this,arguments)},set:function(a){this.resetVal=a;this.display(a);this.onFieldChange()},display:function(b){var a=this.getTarget();if(this.isValBased(a)){a.val(b)}else{a.html(b)}},getDisplayed:function(){var b=this.getTarget();var a="";if(this.isValBased(b)){a=b.val()}else{a=b.html()}return a},reset:function(){this.set(this.resetVal)},clear:function(){this.set("")},get:function(){return this.resetVal},save:function(){var a=this.getDisplayed();this.resetVal=a},onFieldChange:function(){this.triggerEvent("onChange",this,this.get())},onFieldInvalid:function(a){if(AFrame.Field.cancelInvalid){a.preventDefault()}},isValBased:function(a){return a.is("input")||a.is("textarea")}});AFrame.FieldPluginValidation=(function(){var a=function(){a.sc.constructor.call(this)};AFrame.extend(a,AFrame.Plugin,{setPlugged:function(b){this.calculateValidity=true;b.bindEvent("onChange",this.onChange,this);b.getValidityState=this.getValidityState.bind(this);b.validate=this.validate.bind(this);b.setError=this.setError.bind(this);b.setCustomValidity=this.setCustomValidity.bind(this);b.checkValidity=this.checkValidity.bind(this);a.sc.setPlugged.call(this,b)},onChange:function(){this.calculateValidity=true},getValidityState:function(){this.updateValidityState(true);return this.validityState},checkValidity:function(){return this.validate()},validate:function(){this.updateValidityState();var d=this.getPlugged();var b=true;var c=d.getTarget();if(c[0].checkValidity){b=c[0].checkValidity()}else{var f=this.getCriteria();var e=d.get();e=e.length?e:undefined;AFrame.DataValidation.validate({data:e,criteria:f,fieldValidityState:this.validityState});b=this.validityState.valid}return b},updateValidityState:function(b){if(this.calculateValidity){this.validityState=AFrame.FieldValidityState.getInstance(this.getPlugged().getTarget()[0].validity);if(b){this.validate()}this.calculateValidity=false}},setError:function(b){this.updateValidityState(true);this.getPlugged().getTarget().trigger("invalid");return this.validityState.setError(b)},setCustomValidity:function(b){this.updateValidityState(true);this.getPlugged().getTarget().trigger("invalid");return this.validityState.setCustomValidity(b)},getCriteria:function(){var c=this.getPlugged().getTarget();var b=c.attr("type");if(!b||b=="textarea"){b="text"}var d={type:b};if(c.hasAttr("required")){d.required=true}if(c.hasAttr("min")){d.min=parseFloat(c.attr("min"))}if(c.hasAttr("max")){d.max=parseFloat(c.attr("max"))}if(c.hasAttr("step")){d.step=parseFloat(c.attr("step"))}if(c.hasAttr("maxlength")){d.maxlength=parseInt(c.attr("maxlength"),10)}if(c.hasAttr("pattern")){d.pattern=c.attr("pattern")}return d}});return a})();$.fn.hasAttr=function(a){var b=this[0].getAttribute(a);return b!==null};AFrame.FieldValidityState=function(a){if(a){AFrame.mixin(this,a)}};AFrame.FieldValidityState.getInstance=function(a){return new AFrame.FieldValidityState(a||{})};AFrame.FieldValidityState.prototype={valueMissing:false,typeMismatch:false,patternMismatch:false,tooLong:false,rangeUnderflow:false,rangeOverflow:false,stepMismatch:false,customError:false,valid:true,validationMessage:"",setError:function(a){this[a]=true;this.valid=false},setCustomValidity:function(a){if(a){this.valid=false;this.customError=true;this.validationMessage=a}}};AFrame.FieldPlaceholderDecorator={init:function(){var a=AFrame.Field.prototype;this.decorators={};this.decorate("init",this.decoratorInit);this.decorate("bindEvents",this.decoratorBindEvents);this.decorate("set",this.decoratorSet);this.decorate("save",this.decoratorSave);this.decorate("display",this.decoratorDisplay)},decorate:function(b,a){var c=AFrame.Field.prototype;this["_"+b]=c[b];c[b]=a},decoratorInit:function(a){AFrame.FieldPlaceholderDecorator._init.call(this,a);this.display(AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this))},decoratorBindEvents:function(){var a=this.getTarget();this.bindDOMEvent(a,"focus",AFrame.FieldPlaceholderDecorator.onFieldFocus,this);this.bindDOMEvent(a,"blur",AFrame.FieldPlaceholderDecorator.onFieldBlur,this);AFrame.FieldPlaceholderDecorator._bindEvents.call(this)},decoratorSet:function(a){a=a||AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this);AFrame.FieldPlaceholderDecorator._set.call(this,a)},decoratorDisplay:function(c){var b=this.getTarget();var a=c==AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this)?"addClass":"removeClass";b[a]("empty");AFrame.FieldPlaceholderDecorator._display.call(this,c)},decoratorSave:function(){var b=AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this);var a=this.getDisplayed()==b;if(a){this.display("")}AFrame.FieldPlaceholderDecorator._save.call(this);if(a){this.display(b)}},onFieldFocus:function(){if(this.getDisplayed()==AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this)){this.display("")}},onFieldBlur:function(){if(""===this.getDisplayed()){this.display(AFrame.FieldPlaceholderDecorator.getPlaceholder.call(this))}},getPlaceholder:function(){var a=this.getTarget();return a.attr("placeholder")||""}};(function(){var a=document.createElement("input");if(!("placeholder" in a)){AFrame.FieldPlaceholderDecorator.init()}})();AFrame.Schema=function(){};AFrame.Schema.prototype={init:function(a){this.schema=a.schema},getDefaults:function(){var a={};for(var b in this.schema){a[b]=this.getDefaultValue(b)}return a},getDefaultValue:function(a){var b=this.schema[a].def;if(AFrame.func(b)){b=b()}else{if(this.schema[a].has_many){b=[]}else{if(AFrame.Schema.getSchema(this.schema[a].type)){b={}}}}return b},getAppData:function(a){var b={};this.forEach(function(d,c){var e=a[c];if(!AFrame.defined(e)){e=this.getDefaultValue(c)}if(d.has_many){e&&e.forEach&&e.forEach(function(g,f){e[f]=this.getAppDataValue(g,d,a,b)},this)}else{e=this.getAppDataValue(e,d,a,b)}b[c]=e},this);return b},getAppDataValue:function(d,c,f,g){var b=AFrame.Schema.getSchema(c.type);if(b){d=b.getAppData(d)}else{if(AFrame.defined(d)){var e=AFrame.Schema.deserializers[c.type];if(AFrame.func(e)){d=e(d)}}}var a=c.fixup;if(AFrame.func(a)){d=a({value:d,data:f,fixed:g})}return d},serializeItems:function(b){var a={};this.forEach(function(d,c){if(d.save!==false){var e=b[c];if(d.has_many){e&&e.forEach&&e.forEach(function(g,f){e[f]=this.getSerializedValue(g,d,b,a)},this)}else{e=this.getSerializedValue(e,d,b,a)}a[c]=e}},this);return a},getSerializedValue:function(f,e,d,b){var a=e.cleanup;if(AFrame.defined(a)){f=a({value:f,data:d,cleaned:b})}if(AFrame.defined(f)){var c=AFrame.Schema.getSchema(e.type);if(c){f=c.serializeItems(f)}else{var g=AFrame.Schema.serializers[e.type];if(AFrame.func(g)){f=g(f)}}}return f},forEach:function(d,b){for(var a in this.schema){var c=this.schema[a];d.call(b,c,a)}},validate:function(a,d){var c={};var b=false;this.forEach(function(j,g){var h=j.validate||{};var e=jQuery.extend({type:j.type},h);var i=a[g];if(!d||a.hasOwnProperty(g)){var f=this.validateData(a[g],e);if(f.valid){c[g]=true}else{c[g]=f;b=true}}},this);return b?c:true},validateData:function(a,b){return AFrame.DataValidation.validate({data:a,criteria:b})}};AFrame.mixin(AFrame.Schema,{deserializers:{},serializers:{},schemaConfigs:{},schemaCache:{},addDeserializer:function(a,b){AFrame.Schema.deserializers[a]=b},addSerializer:function(a,b){AFrame.Schema.serializers[a]=b},addSchemaConfig:function(b,a){AFrame.Schema.schemaConfigs[b]=a},getSchema:function(a){if(!AFrame.Schema.schemaCache[a]&&AFrame.Schema.schemaConfigs[a]){AFrame.Schema.schemaCache[a]=AFrame.construct({type:AFrame.Schema,config:{schema:AFrame.Schema.schemaConfigs[a]}})}return AFrame.Schema.schemaCache[a]}});AFrame.Schema.addDeserializer("number",function(a){return parseFloat(a)});AFrame.Schema.addDeserializer("integer",function(a){return parseInt(a,10)});AFrame.Schema.addDeserializer("iso8601",function(g){try{var c=g.split("T"),i=c[0].split("-"),h=c[1].split("Z"),d=h[0].split(":"),a=d[2].split("."),b=Number(d[0]),j=new Date;j.setUTCFullYear(Number(i[0]));j.setUTCMonth(Number(i[1])-1);j.setUTCDate(Number(i[2]));j.setUTCHours(Number(b));j.setUTCMinutes(Number(d[1]));j.setUTCSeconds(Number(a[0]));if(a[1]){j.setUTCMilliseconds(Number(a[1]))}return j}catch(f){}});AFrame.Schema.addSerializer("iso8601",function(a){return a.toISOString()});AFrame.ListPluginFormRow=function(){AFrame.ListPluginFormRow.sc.constructor.apply(this,arguments)};AFrame.extend(AFrame.ListPluginFormRow,AFrame.Plugin,{init:function(a){this.formFactory=a.formFactory||this.formFactory;this.forms=[];AFrame.ListPluginFormRow.sc.init.apply(this,arguments)},setPlugged:function(a){a.bindEvent("onInsert",this.onInsertRow,this);a.bindEvent("onRemove",this.onRemoveRow,this);a.validate=this.validate.bind(this);a.save=this.save.bind(this);a.reset=this.reset.bind(this);a.clear=this.clear.bind(this);a.getForm=this.getForm.bind(this);AFrame.ListPluginFormRow.sc.setPlugged.apply(this,arguments)},teardown:function(){this.forms.forEach(function(b,a){b.teardown();this.forms[a]=null},this);AFrame.ListPluginFormRow.sc.teardown.apply(this,arguments)},formFactory:function(b,c){var a=AFrame.construct({type:AFrame.DataForm,config:{target:b,dataSource:c}});return a},onInsertRow:function(c,a){var b=this.formFactory(c.rowElement,c);this.forms.splice(a,0,b)},onRemoveRow:function(c,a){var b=this.forms[a];b.teardown();this.forms[a]=null;this.forms.splice(a,1)},validate:function(a){var c=true;var b;if(AFrame.defined(a)){b=this.forms[a];if(b){c=b.validate()}}else{for(a=0;c&&(b=this.forms[a]);++a){c=b.validate()}}return c},save:function(a){this.formFunc(a,"save")},reset:function(a){this.formFunc(a,"reset")},clear:function(a){this.formFunc(a,"clear")},formFunc:function(a,c){if(AFrame.defined(a)){var b=this.forms[a];if(b){b[c]()}}else{this.forms.forEach(function(e,d){e[c]()})}},getForm:function(a){return this.forms[a]}});AFrame.DataForm=(function(){var b=function(){b.sc.constructor.apply(this,arguments)};AFrame.extend(b,AFrame.Form,{init:function(e){this.dataContainer=AFrame.DataContainer(e.dataSource);b.sc.init.apply(this,arguments)},teardown:function(){this.dataContainer=null;b.sc.teardown.apply(this,arguments)},bindFormElement:function(e){var f=b.sc.bindFormElement.apply(this,arguments);var g=c(f);this.dataContainer.bindField(g,a,f);return f},checkValidity:function(){var e=b.sc.checkValidity.call(this);if(e&&this.dataContainer.checkValidity){e=this.validateFormFieldsWithModels()}return e},validateFormFieldsWithModels:function(){var f=true;var e=this.getFormFields();e.forEach(function(i,g){var j=c(i);var h=this.dataContainer.checkValidity(j,i.get());if(h!==true){f=false;d(i,h)}},this);return f},save:function(){var f=b.sc.save.apply(this,arguments);if(f){var e=this.getFormFields();e.forEach(function(h,g){var i=c(h);this.dataContainer.set(i,h.get())},this)}return f}});function d(g,f){for(var e in f){if(f.hasOwnProperty(e)){var h=f[e];if(h===true){g.setError(e)}else{if("string"==typeof(h)){g.setCustomValidity(h)}}}}}function c(e){return e.getTarget().attr("data-field")}function a(e){this.set(e.value)}return b})();AFrame.DataValidation=(function(){var f=AFrame.defined;var a={};var g={text:"string",number:"number",integer:"number"};var e={validate:function(i){var h=i.data;var l=i.criteria;var m=i.fieldValidityState||AFrame.FieldValidityState.getInstance();var k=l.type||"text";for(var j in l){this.validateDataForTypeCriteria(h,k,j,m,l);this.validateDataForTypeCriteria(h,"all",j,m,l)}return m},validateDataForTypeCriteria:function(i,k,n,m,l){var h=a[k]||{};var j=h[n];if(j){j(i,m,l[n],l)}},setValidator:function(i,j,h){a[i]=a[i]||{};a[i][j]=h}};e.setValidator("all","required",function(h,i){if(!f(h)){i.setError("valueMissing")}});e.setValidator("all","type",function(h,k,j){if(f(h)){var i=g[j];if(i&&i!=typeof(h)){k.setError("typeMismatch")}}});var d=function(h,j,i){if(f(h)&&(h<i)){j.setError("rangeUnderflow")}};e.setValidator("number","min",d);e.setValidator("integer","min",d);var c=function(i,j,h){if(f(i)&&(i>h)){j.setError("rangeOverflow")}};e.setValidator("number","max",c);e.setValidator("integer","max",c);var b=function(h,m,k,l){if(f(h)){var i=l.min||0;var j=0===((h-i)%k);if(!j){m.setError("stepMismatch")}}};e.setValidator("number","step",b);e.setValidator("integer","step",b);e.setValidator("text","maxlength",function(i,j,h){if(f(i)&&i.length&&i.length>h){j.setError("tooLong")}});e.setValidator("text","pattern",function(h,k,j){var i=new RegExp(j);if(f(h)&&!i.test(h)){k.setError("patternMismatch")}});return e})();AFrame.Model=(function(){function b(){b.sc.constructor.call(this)}AFrame.extend(b,AFrame.DataContainer,{init:function(c){this.schema=c.schema;c.data=a(this.schema,c.data);b.sc.init.call(this,c)},set:function(e,d){var c=this.checkValidity(e,d);if(true===c){c=b.sc.set.call(this,e,d)}return c},checkValidity:function(f,e){var d={};d[f]=e;var c=this.schema.validate(d,true);if(c!==true){c=c[f]}return c}});return b;function a(d,c){if(!c){c=d.getDefaults()}return c}})();AFrame.Event=(function(){var a=function(){};a.prototype={constructor:a,init:function(b){for(var c in b){this[c]=b[c]}if(!this.type){throw"Event type undefined"}if(this.target){this.setOriginalTarget=true}this.timestamp=new Date()},isDefaultPrevented:function(){return !!this.defaultPrevented},preventDefault:function(){this.defaultPrevented=true},proxyEvent:function(b){if(this.setOriginalTarget){this.originalTarget=this.target;this.setOriginalTarget=false}this.target=b}};a.createEvent=function(b){var c=AFrame.construct({type:AFrame.Event,config:"string"==typeof(b)?{type:b}:b});return c};return a})();