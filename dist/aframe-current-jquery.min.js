if(!Function.prototype.bind){Function.prototype.bind=function(d){var e=[].slice,b=e.call(arguments,1),a=this,f=function(){},c=function(){return a.apply(this instanceof f?this:(d||{}),b.concat(e.call(arguments)))};f.prototype=a.prototype;c.prototype=new f();return c}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e,c){var a=this.length;if(typeof e!="function"){throw new TypeError()}for(var b=0,d;d=this[b];++b){if(b in this){e.call(c,d,b,this)}}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=c<0?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){var a=function(c){return(c<10?"0":"")+c};var b=function(c){return(c<100?"0":"")+(c<10?"0":"")+c};return[this.getUTCFullYear(),"-",a(this.getUTCMonth()+1),"-",a(this.getUTCDate()),"T",a(this.getUTCHours()),":",a(this.getUTCMinutes()),":",a(this.getUTCSeconds()),".",b(this.getUTCMilliseconds()),"Z"].join("")}}var AFrame=(function(){var a={extendsFrom:function(c,b){var d=false;if(a.func(c)){do{d=c===b;c=c.superclass}while(c&&!d)}return d},mixin:function(c,b){for(var d in b){c[d]=b[d]}return c},create:function(b,c){return b.create(c)},remove:function(b,c){b[c]=null;delete b[c]},currentID:0,getUniqueID:function(){this.currentID++;return"cid"+this.currentID},defined:function(b){return"undefined"!=typeof(b)},log:function(b){if(typeof(console)!=="undefined"){console.log(b)}},func:function(b){return"function"==typeof(b)},string:function(b){return"[object String]"===Object.prototype.toString.apply(b)},array:function(b){return"[object Array]"===Object.prototype.toString.apply(b)}};if(typeof(module)!="undefined"){module.exports=a}return a}());AFrame.Class=(function(){var c=function(){var i=[].slice.call(arguments,0),j=g(i);a(j,i);d(j);h(j);return j};c.walkChain=function(k,j){var i=j.constructor;do{k.call(j,i);i=i.superclass}while(i)};function g(i){var j;if(AFrame.func(i[0])){j=b(i[1],function(){j.sc.constructor.call(this)});f(j,i[0]);i.splice(0,1)}else{j=b(i[0],function(){})}return j}function b(i,k){var j;if(i&&i.hasOwnProperty("constructor")){j=i.constructor}else{j=k}return j}function f(n,l){var m=function(){};m.prototype=l.prototype;n.prototype=new m;n.superclass=l;n.sc=l.prototype;var i=[].slice.call(arguments,2);for(var j,k=0;j=i[k];++k){AFrame.mixin(n.prototype,j)}n.prototype.constructor=n;d(n)}function a(l,k){for(var i,j=0;i=k[j];++j){AFrame.mixin(l.prototype,i)}l.prototype.constructor=l}function d(i){if(i.prototype&&AFrame.func(i.prototype.init)&&!i.create){i.create=c.create.bind(null,i)}}function h(i){i.extend=c.bind(null,i)}c.create=function(i,k){var j;if(i){try{j=new i}catch(l){AFrame.log(l.toString())}AFrame.Class.walkChain(function(m){if(m.prototype&&m.prototype.hasOwnProperty("plugins")){e(j,m.prototype.plugins)}},j);k=k||{};e(j,k.plugins||[]);j.init(k)}else{throw"Class does not exist."}return j};function e(l,i){for(var j=0,k;k=i[j];++j){k=AFrame.array(k)?k:[k];var m=AFrame.mixin({plugged:l},k[1]||{});k[0].create(m)}}return c}());AFrame.Observable=(function(){var a=AFrame.Class({init:function(){this.callbacks={}},teardown:function(){this.unbindAll()},trigger:function(){var c=this,b;c.triggered=true;for(b in c.callbacks){c.callbacks[b].apply(c,arguments)}},bind:function(c){var b=AFrame.getUniqueID();this.callbacks[b]=c;return b},unbind:function(b){AFrame.remove(this.callbacks,b)},unbindAll:function(){var c=this,b;for(b in c.callbacks){AFrame.remove(c.callbacks,b)}},isTriggered:function(){return !!this.triggered}});return a}());AFrame.ObservablesMixin={triggerEvent:function(){var f=this,e=arguments[0],d=!AFrame.string(e),b=d?e.type:e,g=f.handlers&&f.handlers[b];if(g){e=d?e:{type:e};f.setEventData(e);var a=f.getEventObject(),c=Array.prototype.slice.call(arguments,1);c.splice(0,0,a);g.trigger.apply(g,c);return a}},setEventData:function(b){var a=this;if(a.eventData){AFrame.mixin(a.eventData,b)}else{a.eventData=b}},getEventObject:function(){var b=this;if(!b.eventData.target){b.eventData.target=b}var a=b.event||AFrame.Event.create(b.eventData);b.eventData=b.event=null;return a},isEventTriggered:function(b){var c=this,a=false,d=c.handlers&&c.handlers[b];if(d){a=d.isTriggered()}return a},bindEvent:function(a,d,b){var c=this;handlers=c.handlers=c.handlers||{},bindings=c.bindings=c.bindings||{},observable=handlers[a]||AFrame.Observable.create(),eid=observable.bind(d.bind(b||c));handlers[a]=observable;bindings[eid]={object:b,observable:observable};b&&b.bindTo&&b.bindTo(c,eid);return eid},unbindEvent:function(d){var c=this.bindings,b=c&&c[d],a=b&&b.object;if(b){AFrame.remove(c,d);a&&a.unbindTo&&a.unbindTo(d);return b.observable.unbind(d)}},unbindAll:function(){var c=this,b,f,a=c.handlers,e=c.bindings,d;for(b in a){a[b].unbindAll();AFrame.remove(a,b)}for(f in e){d=e[f];AFrame.remove(e,f);if(d.object&&d.object.unbindTo){d.object.unbindTo(f)}}},proxyEvents:function(e,d){var c=this,a,b;d.forEach(function(f,g){e.bindEvent(f,function(){a=Array.prototype.slice.call(arguments,1);c.event=b=arguments[0];b.originalTarget=b.target;b.target=c;a.splice(0,0,f);c.triggerEvent.apply(c,a)})})},bindTo:function(a,d){var b=this,c=b.boundTo=b.BoundTo||{};c[d]=c[d]||{object:a}},unbindTo:function(c){var b=this.boundTo,a=b[c];if(a){a.object.unbindEvent(c);AFrame.remove(b,c)}},unbindToAll:function(){var a=this,c=a.boundTo,b;for(b in c){c[b].object.unbindEvent(b);AFrame.remove(c,b)}a.boundTo=null;a.boundTo={}}};AFrame.EnumerableMixin=(function(){var a={filter:function(c){var b=[];this.forEach(function(d,e){if(true===c(d,e,this)){b.push(d)}},this);return b},search:function(b){return this.filter(b)[0]},getCount:function(){var b=0;this.forEach(function(c){b++});return b}};return a}());AFrame.AObject=(function(){var b=AFrame.Class({init:function(d){var e=this;e.config=d;e.cid=d.cid||AFrame.getUniqueID();e.children={};a.call(e);e.bindEvents();e.triggerEvent("onInit")},getConfig:function(){return this.config},bindEvents:function(){c.call(this)},teardown:function(){var d=this;d.triggerEvent("onTeardown");d.unbindAll();d.unbindToAll();d.teardownChildren();d.config=d.cid=d.children=null},teardownChildren:function(){for(var e in this.children){var d=this.children[e];d.teardown();AFrame.remove(this.children,e)}},getCID:function(){return this.cid},addChild:function(d){this.children[d.getCID()]=d},removeChild:function(d){AFrame.remove(this.children,d)},triggerProxy:function(d){return this.triggerEvent.bind(this,d)}},AFrame.ObservablesMixin);function a(){var d=this;AFrame.Class.walkChain(function(e){if(e.prototype.hasOwnProperty("importconfig")){var f=e.prototype.importconfig;f.forEach(function(g){if(AFrame.defined(d.config[g])){d[g]=d.config[g]}})}},d)}function c(){var h=this,f,e,i;AFrame.Class.walkChain(function(j){if(j.prototype.hasOwnProperty("events")){f=j.prototype.events;for(e in f){i=d.call(h,e);g.call(h,i.name,i.target,f[e])}}},h);function d(j){var l=j.split(" "),k=h[l[1]]||h;return{name:l[0],target:k}}function g(k,l,j){j=AFrame.array(j)?j:[j];j.forEach(function(m){m=AFrame.func(m)?m:h[m];l.bindEvent(k,m,h)})}}return b}());AFrame.DataContainer=(function(){var a=AFrame.AObject.extend({init:function(b){var c=this,d=c.data=b.data||{};if(d.__dataContainer){throw Error("Cannot create a second DataContainer for an object")}d.__dataContainer=c;c.fieldBindings={};a.sc.init.call(c,b)},set:function(f,e){if("object"===typeof(f)){var b={};for(var d in f){b[d]=this.set(d,f[d])}return b}var c=this.data[f];this.data[f]=e;this.triggerEvent({fieldName:f,oldValue:c,value:e,type:"onSet"});this.triggerEvent({fieldName:f,oldValue:c,value:e,type:"onSet-"+f});return c},get:function(b){return this.data[b]},toJSON:function(){var d=this.data,b={},c;for(c in d){if(c!=="__dataContainer"){b[c]=d[c]}}return b},bindField:function(e,d,b){this.setEventData({container:this,fieldName:e,oldValue:undefined,value:this.get(e),type:"onSet:"+e});var c=this.getEventObject();d.call(b,c);return this.bindEvent("onSet-"+e,d,b)},unbindField:function(b){return this.unbindEvent(b)},forEach:function(d,c){for(var b in this.data){if(b!=="__dataContainer"){d.call(c,this.data[b],b)}}}},AFrame.EnumerableMixin);a.create=function(b){b=b||{};var c=b.data=b.data||{};if(c instanceof a){return c}else{if(c.__dataContainer){return c.__dataContainer}}var d=AFrame.Class.create(a,b);return d};return a}());AFrame.Plugin=(function(){var a=AFrame.AObject.extend({importconfig:["plugged"],events:{"onTeardown plugged":"teardown","onInit plugged":"onPluggedInit"},getPlugged:function(){return this.plugged},teardown:function(){AFrame.remove(this,"plugged");a.sc.teardown.call(this)},onPluggedInit:function(){}});return a}());AFrame.ArrayCommonFuncsMixin=(function(){var a={getCount:function(){throw"operation not supported"},getActualInsertIndex:function(c){var b=this.getCount();if("undefined"==typeof(c)){c=b}else{if(c<0){c=b+(c+1)}}c=Math.max(0,c);c=Math.min(b,c);return c},getActualIndex:function(c){var b=this.getCount();if(c<0){c=b+c}if(c<0||b<=c){c=undefined}return c}};return a}());AFrame.CollectionHash=(function(){var a=AFrame.AObject.extend(AFrame.EnumerableMixin,{init:function(c){this.hash={};a.sc.init.call(this,c)},teardown:function(){for(var c in this.hash){AFrame.remove(this.hash,c)}AFrame.remove(this,"hash");a.sc.teardown.call(this)},get:function(c){return this.hash[c]},remove:function(g,c){var f=this,g="object"===typeof(g)?b.call(f,g):g,e=f.get(g);if(e){var d=f.triggerEvent({item:e,cid:g,type:"onBeforeRemove",force:c&&c.force});if(f.shouldDoAction(c,d)){AFrame.remove(f.hash,g);f.triggerEvent({item:e,cid:g,type:"onRemove",force:c&&c.force});return e}}},insert:function(e,c){var f=this.getItemCID(e);var d=this.triggerEvent({item:e,cid:f,type:"onBeforeInsert",force:c&&c.force});if(this.shouldDoAction(c,d)){if(e instanceof Object){e.cid=f}this.hash[f]=e;this.triggerEvent({item:e,cid:f,type:"onInsert",force:c&&c.force});return f}},shouldDoAction:function(c,d){return(c&&c.force)||!(d&&d.isDefaultPrevented())},clear:function(){for(var c in this.hash){this.remove(c)}},forEach:function(f,c){var d=this.hash;for(var e in d){f.call(c,d[e],e)}},getItemCID:function(c){var d=c.cid||AFrame.getUniqueID();if("undefined"!=typeof(this.get(d))){throw"duplicate cid"}return d}});a.currID=0;function b(d){var e=this.hash;for(var c in e){if(d===e[c]){return c}}}return a})();AFrame.CollectionArray=(function(){var a=AFrame.CollectionHash.extend(AFrame.ArrayCommonFuncsMixin,{init:function(b){this.itemCIDs=[];a.sc.init.call(this,b)},teardown:function(){this.itemCIDs.forEach(function(c,b){this.itemCIDs[b]=null},this);AFrame.remove(this,"itemCIDs");a.sc.teardown.apply(this)},insert:function(d,b){var c=this,e=c.getItemCID(d);b="number"==typeof(b)?b:-1;c.currentIndex=c.getActualInsertIndex(b);c.itemCIDs.splice(c.currentIndex,0,e);d.cid=e;a.sc.insert.call(c,d);return e},get:function(c){var d=this.getCID(c);var b;if(d){b=a.sc.get.call(this,d)}return b},remove:function(c){var d;if("string"==typeof(c)){d=c;c=this.getIndex(c)}else{c=this.getActualIndex(c);d=this.getCID(c)}var b;if(c>-1){this.itemCIDs.splice(c,1);this.currentIndex=c;b=a.sc.remove.call(this,d)}return b},clear:function(){a.sc.clear.call(this);this.itemCIDs=[]},getCount:function(){return this.itemCIDs.length},getArray:function(){var b=[];this.itemCIDs.forEach(function(d,c){b[c]=this.hash.get(d)});return b},getEventObject:function(){var b=a.sc.getEventObject.call(this);b.index=this.currentIndex;return b},getCID:function(b){var c=b;if("number"==typeof(b)){b=this.getActualIndex(b);c=this.itemCIDs[b]}return c},getIndex:function(b){if("string"==typeof(b)){b=this.itemCIDs.indexOf(b)}return b},forEach:function(f,c){for(var d,b=0,e;e=this.itemCIDs[b];++b){d=this.get(e);f.call(c,d,b)}}});return a})();AFrame.Display=(function(){var b=0;var c=AFrame.AObject.extend({init:function(e){var f=this;f.target=AFrame.DOM.getElements(e.target);if(!f.target.length){throw"invalid target"}f.render();f.domEventHandlers={};c.sc.init.call(f,e);if(e.bindEvents!==false){f.bindDOMEvents()}},teardown:function(){this.unbindDOMEvents();this.target=null;c.sc.teardown.call(this)},render:function(){this.triggerEvent("onRender",this)},getTarget:function(){return this.target},getDOMElement:function(){return this.target[0]},bindDOMEvents:a,unbindDOMEvents:function(){for(var e in this.domEventHandlers){this.unbindDOMEvent(e)}},bindDOMEvent:function(i,e,k,f){var g=k.bind(f||this);var h=d.call(this,i);AFrame.DOM.bindEvent(h,e,g);b++;var j=b;this.domEventHandlers[j]={target:h,eventName:e,callback:g};return j},bindClick:function(f,g,e){return this.bindDOMEvent(f,"click",function(h){h.preventDefault();g.call(this,h)},e)},unbindDOMEvent:function(f){var e=this.domEventHandlers[f];if(e){AFrame.DOM.unbindEvent(e.target,e.eventName,e.callback);e.target=e.eventName=e.callback=null;AFrame.remove(this.domEventHandlers,f)}}});function d(f){var e;if("string"==typeof(f)){e=AFrame.DOM.getElementsIncludeRoot(f,this.getTarget())}else{e=AFrame.DOM.getElements(f)}return e}function a(){var g=this,h=g.getTarget();AFrame.Class.walkChain(function(k){if(k.prototype.hasOwnProperty("domevents")){var i=k.prototype.domevents;for(var j in i){var l=e.call(g,j);f.call(g,l.name,l.target,i[j])}}},g);function e(i){var k=i.split(" ");var j=k.length==1?g.getTarget():k.slice(1).join(" ");return{name:k[0],target:j}}function f(j,k,i){i=AFrame.array(i)?i:[i];i.forEach(function(l){l=AFrame.func(l)?l:g[l];g.bindDOMEvent(k,j,l)})}}return c})();AFrame.List=(function(){var b=AFrame.Display.extend(AFrame.ArrayCommonFuncsMixin,AFrame.EnumerableMixin,{init:function(c){var d=this;d.renderItem=c.renderItem||d.renderItem;b.sc.init.call(d,c)},clear:function(){AFrame.DOM.setInner(this.getTarget(),"")},renderItem:function(){return AFrame.DOM.createElement("li")},insert:function(f,c){var e=this;c=e.getActualInsertIndex(c);var d=e.renderItem(f,c);c=e.insertElement(d,c);a(e,"onInsert",d,c,f);return c},insertElement:function(e,c){var d=this,f=d.getTarget();c=d.getActualInsertIndex(c);AFrame.DOM.insertAsNthChild(e,f,c);a(d,"onInsertElement",e,c);return c},remove:function(c){var f=this,d=f.getActualIndex(c),e=AFrame.DOM.getNthChild(f.getTarget(),d);AFrame.DOM.removeElement(e);a(f,"onRemoveElement",e,c)},forEach:function(e,d){var c=AFrame.DOM.getChildren(this.getTarget());AFrame.DOM.forEach(c,e,d)}});function a(f,e,d,c,g){f.triggerEvent({rowElement:d,index:c,data:g,type:e})}return b})();AFrame.ListPluginBindToCollection=(function(){var a=AFrame.Plugin.extend({importconfig:["collection"],events:{"onInsert collection":"onInsert","onRemove collection":"onRemove"},init:function(b){this.cids=[];a.sc.init.call(this,b);this.getPlugged().getIndex=this.getIndex.bind(this)},onInsert:function(c){var b=this.getPlugged().insert(c.item,c.index||-1);this.cids.splice(b,0,c.cid)},onRemove:function(c){var b=this.cids.indexOf(c.cid);this.getPlugged().remove(b);this.cids.splice(b,1)},getIndex:function(c){var b=c;if("string"==typeof(c)){b=this.cids.indexOf(c)}return b}});return a}());AFrame.CollectionPluginPersistence=(function(){var c=AFrame.Plugin.extend({init:function(e){this.addCallback=e.addCallback||this.addCallback||d;this.saveCallback=e.saveCallback||this.saveCallback||d;this.loadCallback=e.loadCallback||this.loadCallback||d;this.deleteCallback=e.deleteCallback||this.deleteCallback||d;c.sc.init.call(this,e);var f=this.getPlugged();f.add=this.add.bind(this);f.load=this.load.bind(this);f.del=this.del.bind(this);f.save=this.save.bind(this)},add:function(h,e){e=b(this,e);var i=e.onComplete;var g=this.getPlugged();var f=g.triggerEvent(a("onBeforeAdd",h,e));if(g.shouldDoAction(e,f)){e.onComplete=function(j){h=j||h;var k=g.insert(h,e.insertAt);e.cid=k;e.onComplete=i;i&&i(h,e);g.triggerEvent(a("onAdd",h,e))};this.addCallback(h,e)}},load:function(e){e=b(this,e);var g=this.getPlugged();var f=g.triggerEvent({type:"onBeforeLoad",force:e&&e.force});if(g.shouldDoAction(e,f)){var i=e.onComplete;g.triggerEvent({type:"onLoadStart",force:e&&e.force});e.onComplete=h.bind(this,i,e);this.loadCallback(e)}function h(l,k,j){if(j){j.forEach(function(n,m){g.insert(n)})}k.onComplete=l;l&&l(j,k);g.triggerEvent({items:j,type:"onLoad",force:k&&k.force})}},del:function(i,e){var h=this.getPlugged();var g=h.get(i);if(g){var f=h.triggerEvent(a("onBeforeDelete",g,e));if(h.shouldDoAction(e,f)){e=b(this,e);var j=e.onComplete;e.onComplete=function(){h.remove(i,e);e.onComplete=j;j&&j(g,e)};this.deleteCallback(g,e);h.triggerEvent(a("onDelete",g,e))}}},save:function(i,e){var h=this.getPlugged();var g=h.get(i);if(g){var f=h.triggerEvent(a("onBeforeSave",g,e));if(h.shouldDoAction(e,f)){e=b(this,e);var j=e.onComplete;e.onComplete=function(){e.onComplete=j;j&&j(g,e)}.bind(this);this.saveCallback(g,e);h.triggerEvent(a("onSave",g,e))}}}});function b(f,e){e=e||{};e.collection=f.getPlugged();return e}function a(f,h,e){var g={type:f,item:h};if(h.cid){g.cid=h.cid}if(e&&e.force){g.force=true}return g}function d(f,e){var g=e.onComplete;g&&g(f,e)}return c})();AFrame.CollectionPluginREST=(function(){var b=AFrame.CollectionPluginPersistence.extend({importconfig:["url","net"],loadCallback:function(e){var f=this;f.net.ajax({url:f.url,success:e.onComplete})},addCallback:function(g,e){var f=this;f.net.ajax({url:f.url,data:c(g),type:"POST",success:function(h,k,j){var i=j.getResponseHeader("Location");i=i.replace(f.url+"/","");a(g,"id",i);e.onComplete&&e.onComplete()}})},deleteCallback:function(g,e){var f=this;f.net.ajax({url:f.url+"/"+d(g),type:"DELETE",success:e.onComplete})},saveCallback:function(g,e){var f=this;f.net.ajax({url:f.url+"/"+d(g),data:c(g),type:"PUT",success:e.onComplete})}});function d(e){return e.get?e.get("id"):e.id}function c(e){return e.toJSON?e.toJSON():e}function a(f,e,g){if(f.set){f.set(e,g)}else{f[e]=g}}return b}());AFrame.CollectionPluginModel=(function(){var b=AFrame.Plugin.extend({importconfig:["schema"],init:function(d){var f=this;f.modelFactory=d.modelFactory||a;b.sc.init.call(f,d);f.defaultModelConstructor=AFrame.extendsFrom(f.schema,AFrame.Model)?f.schema:AFrame.Model;var e=f.getPlugged();e.insert=c.bind(f,e.insert);if(e.add){e.add=c.bind(f,e.add)}}});function c(f,e,d){if(!(e instanceof AFrame.Model)){e=this.modelFactory(e)}return f.call(this.getPlugged(),e,d)}function a(e){var d=this.defaultModelConstructor.create({schema:this.schema,data:e});return d}return b}());AFrame.Form=(function(){var b=AFrame.Display.extend(AFrame.EnumerableMixin,{init:function(d){var e=this;e.fieldFactory=d.fieldFactory||e.fieldFactory||a;e.elements=[];e.fields=[];b.sc.init.call(e,d);e.bindFormElements()},bindFormElements:function(){var d=this,e=AFrame.DOM.getDescendentElements("[data-field]",d.getTarget());AFrame.DOM.forEach(e,d.bindFormElement,d)},teardown:function(){var d=this;d.forEach(function(f,e){f.teardown();d.fields[e]=null});d.fields=d.elements=null;b.sc.teardown.call(d)},bindFormElement:function(d){var e=this,g=AFrame.DOM.getElements(d),f=e.fieldFactory(g);e.elements.push(g);e.fields.push(f);return f},getFormElements:function(){return this.elements},getFormFields:function(){return this.fields},checkValidity:function(){var e=true;for(var d=0,f;(f=this.fields[d])&&e;++d){e=f.checkValidity()}return e},clear:function(){c.call(this,"clear")},reset:function(){c.call(this,"reset")},save:function(){var e=this,d=e.checkValidity();if(d){c.call(e,"save")}return d},forEach:function(e,d){this.fields&&this.fields.forEach(e,d)}});b.setDefaultFieldFactory=function(d){a=d};function c(d){this.forEach(function(f,e){f[d]()});this.triggerEvent(d)}function a(d){return AFrame.Field.create({target:d})}return b}());AFrame.Field=(function(){var a=AFrame.Display.extend({domevents:{keyup:"onFieldChange",invalid:"onFieldInvalid"},init:function(c){b.call(this);a.sc.init.call(this,c);this.save()},set:function(c){this.resetVal=c;this.display(c);this.onFieldChange()},display:function(d){var c=this.getTarget();AFrame.DOM.setInner(c,d||"")},getDisplayed:function(){var c=this.getTarget();return AFrame.DOM.getInner(c)},get:function(){return this.getDisplayed()},reset:function(){this.set(this.resetVal)},clear:function(){this.set("")},save:function(){var c=this.getDisplayed();if(!c.length){var d;c=d}this.resetVal=c},onFieldChange:function(){this.triggerEvent("onChange",this,this.get())},onFieldInvalid:function(c){if(a.cancelInvalid){c&&c.preventDefault()}}});a.cancelInvalid=true;function b(){if(!this.validate){var c=AFrame.FieldPluginValidation.create({plugged:this})}}return a}());AFrame.FieldPluginValidation=(function(){var a=AFrame.Plugin.extend({events:{"onChange plugged":b},init:function(c){this.calculateValidity=true;a.sc.init.call(this,c);var d=this.getPlugged();d.getValidityState=this.getValidityState.bind(this);d.validate=this.validate.bind(this);d.setError=this.setError.bind(this);d.setCustomValidity=this.setCustomValidity.bind(this);d.checkValidity=this.checkValidity.bind(this)},getValidityState:function(){this.updateValidityState(true);return this.validityState},checkValidity:function(){return this.validate()},validate:function(){this.updateValidityState();var e=this.getPlugged();var c=true;var d=e.getTarget();if(d[0].checkValidity){c=d[0].checkValidity()}else{var g=this.getCriteria();var f=e.get();AFrame.DataValidation.validate({data:f,criteria:g,fieldValidityState:this.validityState});c=this.validityState.valid}return c},updateValidityState:function(c){if(this.calculateValidity){this.validityState=AFrame.FieldValidityState.create(this.getPlugged().getTarget()[0].validity);if(c){this.validate()}this.calculateValidity=false}},setError:function(c){this.updateValidityState(true);AFrame.DOM.fireEvent(this.getPlugged().getTarget(),"invalid");return this.validityState.setError(c)},setCustomValidity:function(c){this.updateValidityState(true);AFrame.DOM.fireEvent(this.getPlugged().getTarget(),"invalid");return this.validityState.setCustomValidity(c)},getCriteria:function(){var f=this.getPlugged().getTarget();var e=AFrame.DOM.hasAttr;var c=AFrame.DOM.getAttr;var d=c(f,"type");if(!d||d=="textarea"){d="text"}var g={type:d};if(e(f,"required")){g.required=true}if(e(f,"min")){g.min=parseFloat(c(f,"min"))}if(e(f,"max")){g.max=parseFloat(c(f,"max"))}if(e(f,"step")){g.step=parseFloat(c(f,"step"))}if(e(f,"maxlength")){g.maxlength=parseInt(c(f,"maxlength"),10)}if(e(f,"pattern")){g.pattern=c(f,"pattern")}return g}});function b(){this.calculateValidity=true}return a})();AFrame.FieldValidityState=function(a){if(a){AFrame.mixin(this,a)}};AFrame.FieldValidityState.create=function(a){return new AFrame.FieldValidityState(a||{})};AFrame.FieldValidityState.prototype={valueMissing:false,typeMismatch:false,patternMismatch:false,tooLong:false,rangeUnderflow:false,rangeOverflow:false,stepMismatch:false,customError:false,valid:true,validationMessage:"",setError:function(a){this[a]=true;this.valid=false},setCustomValidity:function(a){if(a){this.valid=false;this.customError=true;this.validationMessage=a}}};AFrame.FieldPluginPlaceholder=(function(){var c={init:function(){this.decorators={};b("init",j);b("bindEvents",m);b("get",h);b("getDisplayed",a);b("save",e);b("display",i)}};function b(o,n){var p=AFrame.Field.prototype;c["_"+o]=p[o];p[o]=n}function j(n){c._init.call(this,n);this.display(this.getDisplayed())}function m(){var n=this.getTarget();this.bindDOMEvent(n,"focus",g);this.bindDOMEvent(n,"blur",f);c._bindEvents.call(this)}function h(){var p=l.call(this);var o=c._get.call(this);if(o===p){var n;o=n}return o}function a(){var o=l.call(this);var n=c._getDisplayed.call(this);if(n===o){n=""}return n}function i(n){c._display.call(this,n);d.call(this)}function e(){var o=l.call(this);var n=this.getDisplayed()==o;if(n){this.display("")}c._save.call(this);if(n){this.display(o)}}function g(){this.focused=true;d.call(this)}function f(){this.focused=false;d.call(this)}function d(){var p=l.call(this);var n=c._getDisplayed.call(this);var o=this.getTarget();AFrame.DOM.removeClass(o,"empty");if(this.focused){if(p==n){c._display.call(this,"")}}else{if(""===c._getDisplayed.call(this)){AFrame.DOM.addClass(o,"empty");c._display.call(this,l.call(this))}}}function l(){var n=this.getTarget();return AFrame.DOM.getAttr(n,"placeholder")||""}if(typeof(document)!=="undefined"){var k=document.createElement("input");if(!("placeholder" in k)){c.init()}}return c}());AFrame.Schema=(function(){var b="__SchemaID";var a=AFrame.AObject.extend({constructor:function(c){if(c){if(!c[b]){c[b]=AFrame.getUniqueID();a.addSchemaConfig(c[b],c)}return a.getSchema(c[b])}else{a.sc.constructor.call(this)}},init:function(c){this.schema=c.schema;if(!c.schema){throw"Schema.js: Schema requires a schema configuration object"}a.sc.init.call(this,c)},getDefaults:function(){var c={};this.forEach(function(e,d){c[d]=this.getDefaultValue(d)},this);return c},getDefaultValue:function(c){var d=this.schema[c].def;if(AFrame.func(d)){d=d()}else{if(this.schema[c].has_many){d=[]}else{if(a.getSchema(this.schema[c].type)){d={}}}}return d},fromSerializedJSON:function(c){var d={};this.forEach(function(f,e){var g=c[e];if(!AFrame.defined(g)){g=this.getDefaultValue(e)}if(f.has_many){g&&g.forEach&&g.forEach(function(i,h){g[h]=this.fromSerializedJSONValue(i,f,c,d)},this)}else{g=this.fromSerializedJSONValue(g,f,c,d)}d[e]=g},this);return d},fromSerializedJSONValue:function(f,e,h,i){var d=a.getSchema(e.type);if(d){f=d.fromSerializedJSON(f)}else{if(AFrame.defined(f)){var g=a.deserializers[e.type];if(AFrame.func(g)){f=g(f)}}}var c=e.fixup;if(AFrame.func(c)){f=c({value:f,data:h,fixed:i})}return f},toSerializedJSON:function(d){var c={};this.forEach(function(f,e){if(f.save!==false){var g=d[e];if(f.has_many){g&&g.forEach&&g.forEach(function(i,h){g[h]=this.getSerializedValue(i,f,d,c)},this)}else{g=this.getSerializedValue(g,f,d,c)}c[e]=g}},this);return c},getSerializedValue:function(h,g,f,d){var c=g.cleanup;if(AFrame.defined(c)){h=c({value:h,data:f,cleaned:d})}if(AFrame.defined(h)){var e=a.getSchema(g.type);if(e){h=e.toSerializedJSON(h)}else{var i=a.serializers[g.type];if(AFrame.func(i)){h=i(h)}}}return h},forEach:function(f,d){for(var c in this.schema){if(c!==b){var e=this.schema[c];f.call(d,e,c)}}},rowHasMany:function(c){return !!(this.schema[c]&&this.schema[c].has_many)},validate:function(c,f){var e={};var d=false;this.forEach(function(l,i){var j=l.validate||{};var g=AFrame.mixin({type:l.type},j);var k=c[i];if(!f||c.hasOwnProperty(i)){var h=this.validateData(c[i],g);if(h.valid){e[i]=true}else{e[i]=h;d=true}}},this);return d?e:true},validateData:function(c,d){return AFrame.DataValidation.validate({data:c,criteria:d})}});AFrame.mixin(a,{deserializers:{},serializers:{},schemaConfigs:{},schemaCache:{},addDeserializer:function(c,d){a.deserializers[c]=d},addSerializer:function(c,d){a.serializers[c]=d},addSchemaConfig:function(d,c){a.schemaConfigs[d]=c},getSchema:function(c){if(!a.schemaCache[c]&&a.schemaConfigs[c]){a.schemaCache[c]=a.create({schema:a.schemaConfigs[c]})}return a.schemaCache[c]}});a.addDeserializer("number",function(c){return parseFloat(c)});a.addDeserializer("integer",function(c){return parseInt(c,10)});a.addDeserializer("iso8601",function(k){if("string"==typeof(k)){try{var f="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";var j=k.match(new RegExp(f));var i=0;var c=new Date(j[1],0,1);if(j[3]){c.setMonth(j[3]-1)}if(j[5]){c.setDate(j[5])}if(j[7]){c.setHours(j[7])}if(j[8]){c.setMinutes(j[8])}if(j[10]){c.setSeconds(j[10])}if(j[12]){c.setMilliseconds(Number("0."+j[12])*1000)}if(j[14]){i=(Number(j[16])*60)+Number(j[17]);i*=((j[15]=="-")?1:-1)}i-=c.getTimezoneOffset();var h=(Number(c)+(i*60*1000));c.setTime(Number(h));return c}catch(g){}}else{if(k instanceof Date){return k}}});a.addSerializer("iso8601",function(c){return c.toISOString()});return a}());AFrame.ListPluginFormRow=(function(){var a=AFrame.Plugin.extend({events:{"onInsert plugged":"onInsertRow","onRemove plugged":"onRemoveRow"},init:function(b){this.formFactory=b.formFactory||this.formFactory;this.forms=[];a.sc.init.call(this,b);var c=this.getPlugged();c.validate=this.validate.bind(this);c.save=this.save.bind(this);c.reset=this.reset.bind(this);c.clear=this.clear.bind(this);c.getForm=this.getForm.bind(this)},teardown:function(){this.forms.forEach(function(c,b){c.teardown();this.forms[b]=null},this);a.sc.teardown.call(this)},formFactory:function(c,d){var b=AFrame.DataForm.create({target:c,data:d});return b},onInsertRow:function(d,b){var c=this.formFactory(d.rowElement,d.data);this.forms.splice(b,0,c)},onRemoveRow:function(d,b){var c=this.forms[b];c.teardown();this.forms[b]=null;this.forms.splice(b,1)},validate:function(b){var d=true;var c;if(AFrame.defined(b)){c=this.forms[b];if(c){d=c.validate()}}else{for(b=0;d&&(c=this.forms[b]);++b){d=c.validate()}}return d},save:function(b){this.formFunc(b,"save")},reset:function(b){this.formFunc(b,"reset")},clear:function(b){this.formFunc(b,"clear")},formFunc:function(b,d){if(AFrame.defined(b)){var c=this.forms[b];if(c){c[d]()}}else{this.forms.forEach(function(f,e){f[d]()})}},getForm:function(b){return this.forms[b]}});return a}());AFrame.DataForm=(function(){var c=AFrame.Form.extend({importconfig:["autosave"],init:function(g){this.dataContainer=AFrame.DataContainer.create({data:g.data});c.sc.init.call(this,g)},teardown:function(){this.dataContainer=null;c.sc.teardown.call(this)},bindFormElement:function(g){var h=this,i=c.sc.bindFormElement.call(h,g),j=e(i);h.dataContainer.bindField(j,a,i);if(h.autosave){i.bindEvent("onChange",d,h)}return i},checkValidity:function(){var g=c.sc.checkValidity.call(this)&&this.validateFormFieldsWithModel(this.dataContainer);return g},save:function(){var g=c.sc.save.apply(this,arguments);if(g){this.forEach(function(i,h){var j=e(i);this.dataContainer.set(j,i.get())},this)}return g},validateFormFieldsWithModel:function(g){var h=true;if(g.checkValidity){h=b.call(this,g)}return h}});function d(h,i,j){var g=this,k=e(i);if(j!==g.dataContainer.get(k)){g.save()}}function b(g){var h=true;this.forEach(function(k,i){var l=e(k);var j=g.checkValidity(l,k.get());if(j!==true){h=false;f(k,j)}},this);return h}function f(i,h){for(var g in h){if(h.hasOwnProperty(g)){var j=h[g];if(j===true){i.setError(g)}else{if("string"==typeof(j)){i.setCustomValidity(j)}}}}}function e(g){return AFrame.DOM.getAttr(g.getTarget(),"name")}function a(g){this.set(g.value)}return c})();AFrame.DataValidation=(function(){var f=AFrame.defined;var a={};var g={text:"string",number:"number",integer:"number"};var e={validate:function(i){var h=i.data;var l=i.criteria;var m=i.fieldValidityState||AFrame.FieldValidityState.create();var k=l.type||"text";for(var j in l){this.validateDataForTypeCriteria(h,k,j,m,l);this.validateDataForTypeCriteria(h,"all",j,m,l)}return m},validateDataForTypeCriteria:function(i,k,n,m,l){var h=a[k]||{};var j=h[n];if(j){j(i,m,l[n],l)}},setValidator:function(i,j,h){a[i]=a[i]||{};a[i][j]=h}};e.setValidator("all","required",function(h,i){if(!f(h)){i.setError("valueMissing")}});e.setValidator("all","type",function(h,k,j){if(f(h)){var i=g[j];if(i&&i!=typeof(h)){k.setError("typeMismatch")}}});e.setValidator("integer","type",function(h,j,i){if(f(h)){if(parseInt(h,10)!==h){j.setError("typeMismatch")}}});var d=function(h,j,i){if(f(h)&&(h<i)){j.setError("rangeUnderflow")}};e.setValidator("number","min",d);e.setValidator("integer","min",d);var c=function(i,j,h){if(f(i)&&(i>h)){j.setError("rangeOverflow")}};e.setValidator("number","max",c);e.setValidator("integer","max",c);var b=function(h,m,k,l){if(f(h)){var i=l.min||0;var j=0===((h-i)%k);if(!j){m.setError("stepMismatch")}}};e.setValidator("number","step",b);e.setValidator("integer","step",b);e.setValidator("text","required",function(h,i){if(!h){i.setError("valueMissing")}});e.setValidator("text","maxlength",function(i,j,h){if(f(i)&&i.length&&i.length>h){j.setError("tooLong")}});e.setValidator("text","pattern",function(h,k,j){var i=new RegExp(j);if(f(h)&&!i.test(h)){k.setError("patternMismatch")}});return e})();AFrame.Model=(function(){var c=AFrame.DataContainer.extend({init:function(d){this.schema=b(this.schema||d.schema);d.data=a(this.schema,d.data);c.sc.init.call(this,d)},set:function(j,h,g){if("object"===typeof(j)){var d={};for(var f in j){d[f]=this.set(f,j[f],h)}return d}var e=this.checkValidity(j,h);if(true===e||g){var i=c.sc.set.call(this,j,h);if(!g){e=i}}return e},checkValidity:function(g,f){var e={};e[g]=f;var d=this.schema.validate(e,true);if(d!==true){d=d[g]}return d},toSerializedJSON:function(){var d=this.toJSON();return this.schema.toSerializedJSON(d)}});return c;function b(d){var e=d instanceof AFrame.Schema?d:AFrame.Schema(d);return e}function a(f,d){if(!d){d=f.getDefaults()}var g=f.fromSerializedJSON(d);for(var e in g){d[e]=g[e]}return d}})();AFrame.Event=(function(){var a=AFrame.Class({init:function(c){for(var d in c){this[d]=c[d]}if(!this.type){throw"Event type undefined"}if(this.target){this.setOriginalTarget=true}this.timestamp=new Date()},isDefaultPrevented:function(){return !!this.defaultPrevented},preventDefault:function(){this.defaultPrevented=true},proxyEvent:function(c){if(this.setOriginalTarget){this.originalTarget=this.target;this.setOriginalTarget=false}this.target=c}});var b=a.create;a.create=function(c){if(AFrame.string(c)){c={type:c}}return b(c)};return a})();AFrame.DOM=(function(){var b=typeof(window)!=="undefined"&&window.jQuery;var a={getElements:function(d){return b(d)},getDescendentElements:function(d,e){return b(e).find(d)},getElementsIncludeRoot:function(d,e){e=b(e);var f=e.find(d);if(e.is(d)){f=e.add(f)}return f},getChildren:function(d){return b(d).children()},getNthChild:function(d,e){return b(d).children()[e]},forEach:function(e,f,d){b(e).each(function(g,h){f.call(d,h,g)})},removeElement:function(d){b(d).remove()},bindEvent:function(e,d,f){return b(e).bind(d,f)},unbindEvent:function(e,d,f){return b(e).unbind(d,f)},fireEvent:function(d,e){return b(d).trigger(e)},setInner:function(d,e){var f=b(d);if(c(f)){f.val(e)}else{f.html(e)}},getInner:function(e){var f=b(e);var d="";if(c(f)){d=f.val()}else{d=f.html()}return d},setAttr:function(e,d,f){b(e).attr(d,f)},getAttr:function(e,d){return b(e).attr(d)},removeAttr:function(e,d){return b(e).removeAttr(d)},hasAttr:function(e,d){var f=b(e)[0].getAttribute(d);return f!==null},addClass:function(d,e){b(d).addClass(e)},removeClass:function(d,e){b(d).removeClass(e)},hasClass:function(d,e){return b(d).hasClass(e)},createElement:function(f,e){var d=b("<"+f+"/>");if(e){AFrame.DOM.setInner(d,e)}return d},appendTo:function(e,d){b(e).appendTo(b(d))},insertBefore:function(e,d){b(e).insertBefore(d)},insertAsNthChild:function(h,g,e){var f=b(g).children();if(e===f.length){h.appendTo(g)}else{var d=f.eq(e);h.insertBefore(d)}}};function c(d){return d.is("input")||d.is("textarea")}return a}());