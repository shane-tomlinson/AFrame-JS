if(!Function.prototype.bind){Function.prototype.bind=function(d){var e=[].slice,b=e.call(arguments,1),a=this,f=function(){},c=function(){return a.apply(this instanceof f?this:(d||{}),b.concat(e.call(arguments)))};f.prototype=a.prototype;c.prototype=new f();return c}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e,c){var a=this.length;if(typeof e!="function"){throw new TypeError()}for(var b=0,d;d=this[b];++b){if(b in this){e.call(c,d,b,this)}}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=c<0?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){var a=function(c){return(c<10?"0":"")+c};var b=function(c){return(c<100?"0":"")+(c<10?"0":"")+c};return[this.getUTCFullYear(),"-",a(this.getUTCMonth()+1),"-",a(this.getUTCDate()),"T",a(this.getUTCHours()),":",a(this.getUTCMinutes()),":",a(this.getUTCSeconds()),".",b(this.getUTCMilliseconds()),"Z"].join("")}}if(!window.console){window.console=function(){}}var AFrame=(function(){var a={Class:function(){var e;var d=Array.prototype.slice.call(arguments,0);if(a.func(d[0])){e=function(){e.sc.constructor.call(this)};a.extend(e,d[0]);d.splice(0,1)}else{e=function(){}}for(var b,c=0;b=d[c];++c){a.mixin(e.prototype,b)}e.prototype.constructor=e;return e},extend:function(e,g){var f=function(){};f.prototype=g.prototype;e.prototype=new f();e.superclass=g.prototype;e.sc=g.prototype;var b=Array.prototype.slice.call(arguments,2);for(var c,d=0;c=b[d];++d){a.mixin(e.prototype,c)}e.prototype.constructor=e},mixin:function(c,b){c=jQuery.extend(c,b)},construct:function(i){var j=i.type;var b;if(j){var c=i.config||{};var d=i.plugins||[];try{b=new j}catch(h){console.log(h.toString())}for(var g=0,f;f=d[g];++g){var k=a.construct(f);k.setPlugged(b)}b.init(c)}else{throw"Class does not exist."}return b},create:function(b,g){var d;if(b){try{d=new b}catch(i){console.log(i.toString())}g=g||{};var c=g.plugins||[];for(var f=0,h;h=c[f];++f){h=a.array(h)?h:[h];var j=a.create(h[0],h[1]);j.setPlugged(d)}d.init(g)}else{throw"Class does not exist."}return d},remove:function(b,c){b[c]=null;delete b[c]},currentID:0,getUniqueID:function(){this.currentID++;return"cid"+this.currentID},defined:function(b){return"undefined"!=typeof(b)},func:function(b){return"function"==typeof(b)},string:function(b){return"[object String]"===Object.prototype.toString.apply(b)},array:function(b){return"[object Array]"===Object.prototype.toString.apply(b)}};return a}());AFrame.Observable=(function(){var a=function(){};a.getInstance=function(){return AFrame.create(a)};a.prototype={init:function(){this.callbacks={}},teardown:function(){this.unbindAll()},trigger:function(){this.triggered=true;for(var b in this.callbacks){var c=this.callbacks[b];c.apply(this,arguments)}},bind:function(c){var b=AFrame.getUniqueID();this.callbacks[b]=c;return b},unbind:function(b){AFrame.remove(this.callbacks,b)},unbindAll:function(){for(var b in this.callbacks){AFrame.remove(this.callbacks,b)}},isTriggered:function(){return !!this.triggered}};return a}());AFrame.ObservablesMixin={triggerEvent:function(){var e=arguments[0];var d=!AFrame.string(e);var b=d?e.type:e;var f=this.events&&this.events[b];if(f){e=d?e:{type:e};this.setEventData(e);var a=this.getEventObject();var c=Array.prototype.slice.call(arguments,1);c.splice(0,0,a);f.trigger.apply(f,c);return a}},setEventData:function(b){if(!this.eventData){this.eventData=b}else{for(var a in b){this.eventData[a]=b[a]}}},getEventObject:function(){if(!this.eventData.target){this.eventData.target=this}var a=this.event||AFrame.Event.createEvent(this.eventData);this.eventData=null;this.event=null;return a},isEventTriggered:function(b){var a=false;var c=this.events&&this.events[b];if(c){a=c.isTriggered()}return a},bindEvent:function(b,e,c){this.events=this.events||{};var d=this.events[b]||AFrame.Observable.getInstance();this.events[b]=d;var a=d.bind(e.bind(c||this));this.bindings=this.bindings||{};this.bindings[a]={object:c,observable:d};if(c&&c.bindTo){c.bindTo(this,a)}return a},unbindEvent:function(b){var a=this.bindings&&this.bindings[b];if(a){AFrame.remove(this.bindings,b);if(a.object&&a.object.unbindTo){a.object.unbindTo(b)}return a.observable.unbind(b)}},unbindAll:function(){for(var a in this.events){this.events[a].unbindAll();AFrame.remove(this.events,a)}for(var c in this.bindings){var b=this.bindings[c];AFrame.remove(this.bindings,c);if(b.object&&b.object.unbindTo){b.object.unbindTo(c)}}},proxyEvents:function(b,a){a.forEach(function(c,d){b.bindEvent(c,function(){var e=Array.prototype.slice.call(arguments,1);this.event=arguments[0];this.event.originalTarget=this.event.target;this.event.target=this;e.splice(0,0,c);this.triggerEvent.apply(this,e)}.bind(this),this)},this)},bindTo:function(a,b){this.boundTo=this.boundTo||{};this.boundTo[b]=this.boundTo[b]||{object:a}},unbindTo:function(b){var a=this.boundTo[b];if(a){a.object.unbindEvent(b);AFrame.remove(this.boundTo,b)}},unbindToAll:function(){for(var b in this.boundTo){var a=this.boundTo[b];a.object.unbindEvent(b);AFrame.remove(this.boundTo,b)}this.boundTo=null;this.boundTo={}}};AFrame.EnumerableMixin=(function(){var a={filter:function(c){var b=[];this.forEach(function(d,e){if(true===c(d,e,this)){b.push(d)}},this);return b},search:function(b){return this.filter(b)[0]},getCount:function(){var b=0;this.forEach(function(c){b++});return b}};return a}());AFrame.AObject=(function(){var a=AFrame.Class({init:function(b){this.config=b;this.cid=b.cid||AFrame.getUniqueID();this.children={};this.bindEvents();this.triggerEvent("onInit")},getConfig:function(){return this.config},bindEvents:function(){},teardown:function(){this.triggerEvent("onTeardown");this.unbindAll();this.unbindToAll();this.teardownChildren();this.config=this.cid=this.children=null},teardownChildren:function(){for(var c in this.children){var b=this.children[c];b.teardown();AFrame.remove(this.children,c)}},getCID:function(){return this.cid},addChild:function(b){this.children[b.getCID()]=b},removeChild:function(b){AFrame.remove(this.children,b)},"import":function(b){var c=Array.prototype.slice.call(arguments,1);if(c.length){c.forEach(function(e,d){this[e]=b[e]},this)}else{AFrame.mixin(this,b)}},triggerProxy:function(b){return this.triggerEvent.bind(this,b)}},AFrame.ObservablesMixin);return a}());AFrame.DataContainer=(function(){var a=function(b){if(b instanceof a){return b}else{if(b){var c=b.__dataContainer;if(!c){c=AFrame.create(a,{data:b})}return c}}a.sc.constructor.apply(this,arguments)};AFrame.extend(a,AFrame.AObject,AFrame.EnumerableMixin,{init:function(b){this.data=b.data||{};if(this.data.__dataContainer){throw Error("Cannot create a second DataContainer for an object")}this.data.__dataContainer=this;this.fieldBindings={};a.sc.init.apply(this,arguments)},set:function(d,c){var b=this.data[d];this.data[d]=c;this.triggerEvent({fieldName:d,oldValue:b,value:c,type:"onSet"});this.triggerEvent({fieldName:d,oldValue:b,value:c,type:"onSet-"+d});return b},get:function(b){return this.data[b]},getDataObject:function(){return this.data},bindField:function(e,d,b){this.setEventData({container:this,fieldName:e,oldValue:undefined,value:this.get(e),type:"onSet:"+e});var c=this.getEventObject();d.call(b,c);return this.bindEvent("onSet-"+e,d,b)},unbindField:function(b){return this.unbindEvent(b)},forEach:function(d,c){for(var b in this.data){if(b!=="__dataContainer"){d.call(c,this.data[b],b)}}}});return a}());AFrame.Plugin=(function(){var a=AFrame.Class(AFrame.AObject,{setPlugged:function(b){this.plugged=b;this.plugged.bindEvent("onTeardown",this.teardown,this)},getPlugged:function(){return this.plugged},teardown:function(){AFrame.remove(this,"plugged");a.sc.teardown.apply(this,arguments)}});return a}());AFrame.ArrayCommonFuncsMixin={getCount:function(){throw"operation not supported"},getActualInsertIndex:function(b){var a=this.getCount();if("undefined"==typeof(b)){b=a}else{if(b<0){b=a+(b+1)}}b=Math.max(0,b);b=Math.min(a,b);return b},getActualIndex:function(b){var a=this.getCount();if(b<0){b=a+b}b=Math.min(a-1,b);b=Math.max(0,b);return b}};AFrame.CollectionHash=(function(){var a=AFrame.Class(AFrame.AObject,AFrame.EnumerableMixin,{init:function(b){this.hash={};a.sc.init.apply(this,arguments)},teardown:function(){for(var b in this.hash){AFrame.remove(this.hash,b)}AFrame.remove(this,"hash");a.sc.teardown.apply(this,arguments)},get:function(b){return this.hash[b]},remove:function(e,b){var d=this.get(e);if(d){var c=this.triggerEvent({item:d,cid:e,type:"onBeforeRemove",force:b&&b.force});if(this.shouldDoAction(b,c)){AFrame.remove(this.hash,e);this.triggerEvent({item:d,cid:e,type:"onRemove",force:b&&b.force});return d}}},insert:function(d,b){var e=d.cid||AFrame.getUniqueID();if("undefined"!=typeof(this.get(e))){throw"duplicate cid"}var c=this.triggerEvent({item:d,cid:e,type:"onBeforeInsert",force:b&&b.force});if(this.shouldDoAction(b,c)){if(d instanceof Object){d.cid=e}this.hash[e]=d;this.triggerEvent({item:d,cid:e,type:"onInsert",force:b&&b.force});return e}},shouldDoAction:function(b,c){return(b&&b.force)||!(c&&c.isDefaultPrevented())},clear:function(){for(var b in this.hash){this.remove(b)}},forEach:function(e,b){var c=this.hash;for(var d in c){e.call(b,c[d],d)}}});a.currID=0;return a})();AFrame.CollectionArray=(function(){var a=AFrame.Class(AFrame.CollectionHash,AFrame.ArrayCommonFuncsMixin,{init:function(){this.itemCIDs=[];a.sc.init.apply(this,arguments)},teardown:function(){this.itemCIDs.forEach(function(c,b){this.itemCIDs[b]=null},this);AFrame.remove(this,"itemCIDs");a.sc.teardown.apply(this,arguments)},insert:function(c,b){b="number"==typeof(b)?b:-1;this.currentIndex=this.getActualInsertIndex(b);var d=a.sc.insert.call(this,c);this.itemCIDs.splice(this.currentIndex,0,d);return d},get:function(c){var d=this.getCID(c);var b;if(d){b=a.sc.get.call(this,d)}return b},remove:function(c){var d;if("string"==typeof(c)){d=c;c=this.getIndex(c)}else{c=this.getActualIndex(c);d=this.getCID(c)}var b;if(c>-1){this.itemCIDs.splice(c,1);this.currentIndex=c;b=a.sc.remove.call(this,d)}return b},clear:function(){a.sc.clear.call(this);this.itemCIDs=[]},getCount:function(){return this.itemCIDs.length},getArray:function(){var b=[];this.itemCIDs.forEach(function(d,c){b[c]=this.hash.get(d)});return b},getEventObject:function(){var b=a.sc.getEventObject.call(this);b.index=this.currentIndex;return b},getCID:function(b){var c=b;if("number"==typeof(b)){b=this.getActualIndex(b);c=this.itemCIDs[b]}return c},getIndex:function(b){if("string"==typeof(b)){b=this.itemCIDs.indexOf(b)}return b},forEach:function(f,c){for(var d,b=0,e;e=this.itemCIDs[b];++b){d=this.get(e);f.call(c,d,b)}}});return a})();AFrame.Display=(function(){var a=0;var b=AFrame.Class(AFrame.AObject,{init:function(c){this.target=AFrame.DOM.getElements(c.target);if(!this.target.length){throw"invalid target"}this.render();this.domEvents={};b.sc.init.call(this,c)},teardown:function(){for(var c in this.domEvents){this.unbindDOMEvent(c)}this.target=null;b.sc.teardown.call(this)},render:function(){this.triggerEvent("onRender",this)},getTarget:function(){return this.target},getDOMElement:function(){return this.target[0]},bindDOMEvent:function(g,c,i,d){var e=i.bind(d||this);var f=this.getEventTarget(g);AFrame.DOM.bindEvent(f,c,e);a++;var h=a;this.domEvents[h]={target:f,eventName:c,callback:e};return h},bindClick:function(d,e,c){return this.bindDOMEvent(d,"click",function(f){f.preventDefault();e.call(this,f)},c)},unbindDOMEvent:function(d){var c=this.domEvents[d];if(c){AFrame.DOM.unbindEvent(c.target,c.eventName,c.callback);c.target=null;c.eventName=null;c.callback=null;AFrame.remove(this.domEvents,d)}},getEventTarget:function(d){var c;if("string"==typeof(d)){c=AFrame.DOM.getDescendentElements(d,this.getTarget())}else{c=AFrame.DOM.getElements(d)}return c}});return b})();AFrame.List=(function(){var a=AFrame.Class(AFrame.Display,AFrame.ArrayCommonFuncsMixin,AFrame.EnumerableMixin,{init:function(b){if(b.listElementFactory){this.listElementFactory=b.listElementFactory}a.sc.init.apply(this,arguments)},clear:function(){AFrame.DOM.setInner(this.getTarget(),"")},listElementFactory:function(){return AFrame.DOM.createElement("li")},insert:function(d,b){b=this.getActualInsertIndex(b);var c=this.listElementFactory(d,b);b=this.insertElement(c,b);this.triggerEvent({rowElement:c,index:b,data:d,type:"onInsert"});return b},insertElement:function(c,b){var d=this.getTarget();b=this.getActualInsertIndex(b);AFrame.DOM.insertAsNthChild(c,d,b);this.triggerEvent({rowElement:c,index:b,type:"onInsertElement"});return b},remove:function(b){var c=this.getActualIndex(b);var d=AFrame.DOM.getNthChild(this.getTarget(),c);AFrame.DOM.removeElement(d);this.triggerEvent({rowElement:d,index:b,type:"onRemoveElement"})},forEach:function(d,c){var b=AFrame.DOM.getChildren(this.getTarget());AFrame.DOM.forEach(b,d,c)}});return a})();AFrame.ListPluginBindToCollection=(function(){var a=AFrame.Class(AFrame.Plugin,{init:function(b){this.collection=b.collection;this.collection.bindEvent("onInsert",this.onInsert,this);this.collection.bindEvent("onRemove",this.onRemove,this);this.cids=[];a.sc.init.apply(this,arguments)},setPlugged:function(b){b.getIndex=this.getIndex.bind(this);a.sc.setPlugged.apply(this,arguments)},onInsert:function(c){var b=this.getPlugged().insert(c.item,c.index||-1);this.cids.splice(b,0,c.cid)},onRemove:function(c){var b=this.cids.indexOf(c.cid);this.getPlugged().remove(b);this.cids.splice(b,1)},getIndex:function(c){var b=c;if("string"==typeof(c)){b=this.cids.indexOf(c)}return b}});return a}());AFrame.CollectionPluginPersistence=(function(){var c=AFrame.Class(AFrame.Plugin,{init:function(e){this.addCallback=e.addCallback||d;this.saveCallback=e.saveCallback||d;this.loadCallback=e.loadCallback||d;this.deleteCallback=e.deleteCallback||d;c.sc.init.apply(this,arguments)},setPlugged:function(e){e.add=this.add.bind(this);e.load=this.load.bind(this);e.del=this.del.bind(this);e.save=this.save.bind(this);c.sc.setPlugged.apply(this,arguments)},add:function(h,e){e=b(this,e);var i=e.onComplete;var g=this.getPlugged();var f=g.triggerEvent(a("onBeforeAdd",h,e));if(g.shouldDoAction(e,f)){e.onComplete=function(j){h=j||h;var k=g.insert(h,e.insertAt);e.cid=k;e.onComplete=i;i&&i(h,e);g.triggerEvent(a("onAdd",h,e))};this.addCallback(h,e)}},load:function(e){e=b(this,e);var g=this.getPlugged();var f=g.triggerEvent({type:"onBeforeLoad",force:e&&e.force});if(g.shouldDoAction(e,f)){var i=e.onComplete;g.triggerEvent({type:"onLoadStart",force:e&&e.force});e.onComplete=h.bind(this,i,e);this.loadCallback(e)}function h(l,k,j){if(j){j.forEach(function(n,m){g.insert(n)})}k.onComplete=l;l&&l(j,k);g.triggerEvent({items:j,type:"onLoad",force:k&&k.force})}},del:function(i,e){var h=this.getPlugged();var g=h.get(i);if(g){var f=h.triggerEvent(a("onBeforeDelete",g,e));if(h.shouldDoAction(e,f)){e=b(this,e);var j=e.onComplete;e.onComplete=function(){h.remove(i,e);e.onComplete=j;j&&j(g,e)};this.deleteCallback(g,e);h.triggerEvent(a("onDelete",g,e))}}},save:function(i,e){var h=this.getPlugged();var g=h.get(i);if(g){var f=h.triggerEvent(a("onBeforeSave",g,e));if(h.shouldDoAction(e,f)){e=b(this,e);var j=e.onComplete;e.onComplete=function(){e.onComplete=j;j&&j(g,e)}.bind(this);this.saveCallback(g,e);h.triggerEvent(a("onSave",g,e))}}}});function b(f,e){e=e||{};e.collection=f.getPlugged();return e}function a(f,h,e){var g={type:f,item:h};if(h.cid){g.cid=h.cid}if(e&&e.force){g.force=true}return g}function d(f,e){var g=e.onComplete;g&&g(f,e)}return c})();AFrame.CollectionPluginModel=(function(){var b=AFrame.Class(AFrame.Plugin,{init:function(d){this.schema=d.schema;this.modelFactory=d.modelFactory||a;b.sc.init.call(this,d)},setPlugged:function(d){d.insert=c.bind(this,d.insert);if(d.add){d.add=c.bind(this,d.add)}b.sc.setPlugged.call(this,d)}});function c(f,e,d){if(!(e instanceof AFrame.Model)){e=this.modelFactory(e,this.schema)}f.call(this.getPlugged(),e,d)}function a(f,e){var d=AFrame.create(AFrame.Model,{schema:e,data:f});return d}return b}());AFrame.Form=(function(){var b=AFrame.Class(AFrame.Display,AFrame.EnumerableMixin,{init:function(d){this.formFieldFactory=d.formFieldFactory||this.formFieldFactory||a;this.formElements=[];this.formFields=[];b.sc.init.apply(this,arguments);this.bindFormElements()},bindFormElements:function(){var d=AFrame.DOM.getDescendentElements("[data-field]",this.getTarget());AFrame.DOM.forEach(d,this.bindFormElement,this)},teardown:function(){this.forEach(function(e,d){e.teardown();this.formFields[d]=null},this);this.formFields=null;this.formElements=null;b.sc.teardown.apply(this,arguments)},bindFormElement:function(d){var f=AFrame.DOM.getElements(d);this.formElements.push(f);var e=this.formFieldFactory(f);this.formFields.push(e);return e},getFormElements:function(){return this.formElements},getFormFields:function(){return this.formFields},checkValidity:function(){var e=true;for(var d=0,f;(f=this.formFields[d])&&e;++d){e=f.checkValidity()}return e},clear:function(){c.call(this,"clear")},reset:function(){c.call(this,"reset")},save:function(){var d=this.checkValidity();if(d){c.call(this,"save")}return d},forEach:function(e,d){this.formFields&&this.formFields.forEach(e,d)}});b.setDefaultFieldFactory=function(d){a=d};function c(d){this.forEach(function(f,e){f[d]()})}function a(d){return AFrame.create(AFrame.Field,{target:d})}return b}());AFrame.Field=(function(){var a=AFrame.Class(AFrame.Display,{init:function(b){this.createValidator();a.sc.init.apply(this,arguments);this.save()},createValidator:function(){if(!this.validate){var b=AFrame.create(AFrame.FieldPluginValidation);b.setPlugged(this)}},bindEvents:function(){var b=this.getTarget();this.bindDOMEvent(b,"keyup",this.onFieldChange);this.bindDOMEvent(b,"invalid",this.onFieldInvalid);a.sc.bindEvents.apply(this,arguments)},set:function(b){this.resetVal=b;this.display(b);this.onFieldChange()},display:function(c){var b=this.getTarget();AFrame.DOM.setInner(b,c||"")},getDisplayed:function(){var b=this.getTarget();return AFrame.DOM.getInner(b)},get:function(){return this.getDisplayed()},reset:function(){this.set(this.resetVal)},clear:function(){this.set("")},save:function(){var b=this.getDisplayed();if(!b.length){var c;b=c}this.resetVal=b},onFieldChange:function(){this.triggerEvent("onChange",this,this.get())},onFieldInvalid:function(b){if(a.cancelInvalid){b&&b.preventDefault()}}});a.cancelInvalid=true;return a}());AFrame.FieldPluginValidation=(function(){var a=AFrame.Class(AFrame.Plugin,{setPlugged:function(b){this.calculateValidity=true;b.bindEvent("onChange",this.onChange,this);b.getValidityState=this.getValidityState.bind(this);b.validate=this.validate.bind(this);b.setError=this.setError.bind(this);b.setCustomValidity=this.setCustomValidity.bind(this);b.checkValidity=this.checkValidity.bind(this);a.sc.setPlugged.call(this,b)},onChange:function(){this.calculateValidity=true},getValidityState:function(){this.updateValidityState(true);return this.validityState},checkValidity:function(){return this.validate()},validate:function(){this.updateValidityState();var d=this.getPlugged();var b=true;var c=d.getTarget();if(c[0].checkValidity){b=c[0].checkValidity()}else{var f=this.getCriteria();var e=d.get();AFrame.DataValidation.validate({data:e,criteria:f,fieldValidityState:this.validityState});b=this.validityState.valid}return b},updateValidityState:function(b){if(this.calculateValidity){this.validityState=AFrame.FieldValidityState.getInstance(this.getPlugged().getTarget()[0].validity);if(b){this.validate()}this.calculateValidity=false}},setError:function(b){this.updateValidityState(true);AFrame.DOM.fireEvent(this.getPlugged().getTarget(),"invalid");return this.validityState.setError(b)},setCustomValidity:function(b){this.updateValidityState(true);AFrame.DOM.fireEvent(this.getPlugged().getTarget(),"invalid");return this.validityState.setCustomValidity(b)},getCriteria:function(){var e=this.getPlugged().getTarget();var d=AFrame.DOM.hasAttr;var b=AFrame.DOM.getAttr;var c=b(e,"type");if(!c||c=="textarea"){c="text"}var f={type:c};if(d(e,"required")){f.required=true}if(d(e,"min")){f.min=parseFloat(b(e,"min"))}if(d(e,"max")){f.max=parseFloat(b(e,"max"))}if(d(e,"step")){f.step=parseFloat(b(e,"step"))}if(d(e,"maxlength")){f.maxlength=parseInt(b(e,"maxlength"),10)}if(d(e,"pattern")){f.pattern=b(e,"pattern")}return f}});return a})();AFrame.FieldValidityState=function(a){if(a){AFrame.mixin(this,a)}};AFrame.FieldValidityState.getInstance=function(a){return new AFrame.FieldValidityState(a||{})};AFrame.FieldValidityState.prototype={valueMissing:false,typeMismatch:false,patternMismatch:false,tooLong:false,rangeUnderflow:false,rangeOverflow:false,stepMismatch:false,customError:false,valid:true,validationMessage:"",setError:function(a){this[a]=true;this.valid=false},setCustomValidity:function(a){if(a){this.valid=false;this.customError=true;this.validationMessage=a}}};AFrame.FieldPluginPlaceholder=(function(){var c={init:function(){this.decorators={};b("init",j);b("bindEvents",m);b("get",h);b("getDisplayed",a);b("save",e);b("display",i)}};function b(o,n){var p=AFrame.Field.prototype;c["_"+o]=p[o];p[o]=n}function j(n){c._init.call(this,n);this.display(this.getDisplayed())}function m(){var n=this.getTarget();this.bindDOMEvent(n,"focus",g);this.bindDOMEvent(n,"blur",f);c._bindEvents.call(this)}function h(){var p=l.call(this);var o=c._get.call(this);if(o===p){var n;o=n}return o}function a(){var o=l.call(this);var n=c._getDisplayed.call(this);if(n===o){n=""}return n}function i(n){c._display.call(this,n);d.call(this)}function e(){var o=l.call(this);var n=this.getDisplayed()==o;if(n){this.display("")}c._save.call(this);if(n){this.display(o)}}function g(){this.focused=true;d.call(this)}function f(){this.focused=false;d.call(this)}function d(){var p=l.call(this);var n=c._getDisplayed.call(this);var o=this.getTarget();AFrame.DOM.removeClass(o,"empty");if(this.focused){if(p==n){c._display.call(this,"")}}else{if(""===c._getDisplayed.call(this)){AFrame.DOM.addClass(o,"empty");c._display.call(this,l.call(this))}}}function l(){var n=this.getTarget();return AFrame.DOM.getAttr(n,"placeholder")||""}var k=document.createElement("input");if(!("placeholder" in k)){c.init()}return c}());AFrame.Schema=(function(){var b="__SchemaID";var a=function(c){if(c){if(!c[b]){c[b]=AFrame.getUniqueID();a.addSchemaConfig(c[b],c)}return a.getSchema(c[b])}else{a.sc.constructor.call(this)}};AFrame.extend(a,AFrame.AObject,{init:function(c){this.schema=c.schema;if(!c.schema){throw"Schema.js: Schema requires a schema configuration object"}a.sc.init.call(this,c)},getDefaults:function(){var c={};this.forEach(function(e,d){c[d]=this.getDefaultValue(d)},this);return c},getDefaultValue:function(c){var d=this.schema[c].def;if(AFrame.func(d)){d=d()}else{if(this.schema[c].has_many){d=[]}else{if(a.getSchema(this.schema[c].type)){d={}}}}return d},getAppData:function(c){var d={};this.forEach(function(f,e){var g=c[e];if(!AFrame.defined(g)){g=this.getDefaultValue(e)}if(f.has_many){g&&g.forEach&&g.forEach(function(i,h){g[h]=this.getAppDataValue(i,f,c,d)},this)}else{g=this.getAppDataValue(g,f,c,d)}d[e]=g},this);return d},getAppDataValue:function(f,e,h,i){var d=a.getSchema(e.type);if(d){f=d.getAppData(f)}else{if(AFrame.defined(f)){var g=a.deserializers[e.type];if(AFrame.func(g)){f=g(f)}}}var c=e.fixup;if(AFrame.func(c)){f=c({value:f,data:h,fixed:i})}return f},serializeItems:function(d){var c={};this.forEach(function(f,e){if(f.save!==false){var g=d[e];if(f.has_many){g&&g.forEach&&g.forEach(function(i,h){g[h]=this.getSerializedValue(i,f,d,c)},this)}else{g=this.getSerializedValue(g,f,d,c)}c[e]=g}},this);return c},getSerializedValue:function(h,g,f,d){var c=g.cleanup;if(AFrame.defined(c)){h=c({value:h,data:f,cleaned:d})}if(AFrame.defined(h)){var e=a.getSchema(g.type);if(e){h=e.serializeItems(h)}else{var i=a.serializers[g.type];if(AFrame.func(i)){h=i(h)}}}return h},forEach:function(f,d){for(var c in this.schema){if(c!==b){var e=this.schema[c];f.call(d,e,c)}}},rowHasMany:function(c){return !!(this.schema[c]&&this.schema[c].has_many)},validate:function(c,f){var e={};var d=false;this.forEach(function(l,i){var j=l.validate||{};var g=jQuery.extend({type:l.type},j);var k=c[i];if(!f||c.hasOwnProperty(i)){var h=this.validateData(c[i],g);if(h.valid){e[i]=true}else{e[i]=h;d=true}}},this);return d?e:true},validateData:function(c,d){return AFrame.DataValidation.validate({data:c,criteria:d})}});AFrame.mixin(a,{deserializers:{},serializers:{},schemaConfigs:{},schemaCache:{},addDeserializer:function(c,d){a.deserializers[c]=d},addSerializer:function(c,d){a.serializers[c]=d},addSchemaConfig:function(d,c){a.schemaConfigs[d]=c},getSchema:function(c){if(!a.schemaCache[c]&&a.schemaConfigs[c]){a.schemaCache[c]=AFrame.create(a,{schema:a.schemaConfigs[c]})}return a.schemaCache[c]}});a.addDeserializer("number",function(c){return parseFloat(c)});a.addDeserializer("integer",function(c){return parseInt(c,10)});a.addDeserializer("iso8601",function(i){if("string"==typeof(i)){try{var f=i.split("T"),k=f[0].split("-"),j=f[1].split("Z"),g=j[0].split(":"),c=g[2].split("."),d=Number(g[0]),l=new Date;l.setUTCFullYear(Number(k[0]));l.setUTCMonth(Number(k[1])-1);l.setUTCDate(Number(k[2]));l.setUTCHours(Number(d));l.setUTCMinutes(Number(g[1]));l.setUTCSeconds(Number(c[0]));if(c[1]){l.setUTCMilliseconds(Number(c[1]))}return l}catch(h){}}else{if(i instanceof Date){return i}}});a.addSerializer("iso8601",function(c){return c.toISOString()});return a}());AFrame.ListPluginFormRow=(function(){var a=AFrame.Class(AFrame.Plugin,{init:function(b){this.formFactory=b.formFactory||this.formFactory;this.forms=[];a.sc.init.apply(this,arguments)},setPlugged:function(b){b.bindEvent("onInsert",this.onInsertRow,this);b.bindEvent("onRemove",this.onRemoveRow,this);b.validate=this.validate.bind(this);b.save=this.save.bind(this);b.reset=this.reset.bind(this);b.clear=this.clear.bind(this);b.getForm=this.getForm.bind(this);a.sc.setPlugged.apply(this,arguments)},teardown:function(){this.forms.forEach(function(c,b){c.teardown();this.forms[b]=null},this);a.sc.teardown.apply(this,arguments)},formFactory:function(c,d){var b=AFrame.create(AFrame.DataForm,{target:c,dataSource:d});return b},onInsertRow:function(d,b){var c=this.formFactory(d.rowElement,d.data);this.forms.splice(b,0,c)},onRemoveRow:function(d,b){var c=this.forms[b];c.teardown();this.forms[b]=null;this.forms.splice(b,1)},validate:function(b){var d=true;var c;if(AFrame.defined(b)){c=this.forms[b];if(c){d=c.validate()}}else{for(b=0;d&&(c=this.forms[b]);++b){d=c.validate()}}return d},save:function(b){this.formFunc(b,"save")},reset:function(b){this.formFunc(b,"reset")},clear:function(b){this.formFunc(b,"clear")},formFunc:function(b,d){if(AFrame.defined(b)){var c=this.forms[b];if(c){c[d]()}}else{this.forms.forEach(function(f,e){f[d]()})}},getForm:function(b){return this.forms[b]}});return a}());AFrame.DataForm=(function(){var c=AFrame.Class(AFrame.Form,{init:function(f){this.dataContainer=AFrame.DataContainer(f.dataSource);c.sc.init.apply(this,arguments)},teardown:function(){this.dataContainer=null;c.sc.teardown.apply(this,arguments)},bindFormElement:function(f){var g=c.sc.bindFormElement.apply(this,arguments);var h=d(g);this.dataContainer.bindField(h,a,g);return g},checkValidity:function(){var f=c.sc.checkValidity.call(this)&&this.validateFormFieldsWithModel(this.dataContainer);return f},save:function(){var f=c.sc.save.apply(this,arguments);if(f){this.forEach(function(h,g){var i=d(h);this.dataContainer.set(i,h.get())},this)}return f},validateFormFieldsWithModel:function(f){var g=true;if(f.checkValidity){g=b.call(this,f)}return g}});function b(f){var g=true;this.forEach(function(j,h){var k=d(j);var i=f.checkValidity(k,j.get());if(i!==true){g=false;e(j,i)}},this);return g}function e(h,g){for(var f in g){if(g.hasOwnProperty(f)){var i=g[f];if(i===true){h.setError(f)}else{if("string"==typeof(i)){h.setCustomValidity(i)}}}}}function d(f){return AFrame.DOM.getAttr(f.getTarget(),"name")}function a(f){this.set(f.value)}return c})();AFrame.DataValidation=(function(){var f=AFrame.defined;var a={};var g={text:"string",number:"number",integer:"number"};var e={validate:function(i){var h=i.data;var l=i.criteria;var m=i.fieldValidityState||AFrame.FieldValidityState.getInstance();var k=l.type||"text";for(var j in l){this.validateDataForTypeCriteria(h,k,j,m,l);this.validateDataForTypeCriteria(h,"all",j,m,l)}return m},validateDataForTypeCriteria:function(i,k,n,m,l){var h=a[k]||{};var j=h[n];if(j){j(i,m,l[n],l)}},setValidator:function(i,j,h){a[i]=a[i]||{};a[i][j]=h}};e.setValidator("all","required",function(h,i){if(!f(h)){i.setError("valueMissing")}});e.setValidator("all","type",function(h,k,j){if(f(h)){var i=g[j];if(i&&i!=typeof(h)){k.setError("typeMismatch")}}});var d=function(h,j,i){if(f(h)&&(h<i)){j.setError("rangeUnderflow")}};e.setValidator("number","min",d);e.setValidator("integer","min",d);var c=function(i,j,h){if(f(i)&&(i>h)){j.setError("rangeOverflow")}};e.setValidator("number","max",c);e.setValidator("integer","max",c);var b=function(h,m,k,l){if(f(h)){var i=l.min||0;var j=0===((h-i)%k);if(!j){m.setError("stepMismatch")}}};e.setValidator("number","step",b);e.setValidator("integer","step",b);e.setValidator("text","required",function(h,i){if(!h){i.setError("valueMissing")}});e.setValidator("text","maxlength",function(i,j,h){if(f(i)&&i.length&&i.length>h){j.setError("tooLong")}});e.setValidator("text","pattern",function(h,k,j){var i=new RegExp(j);if(f(h)&&!i.test(h)){k.setError("patternMismatch")}});return e})();AFrame.Model=(function(){var c=AFrame.Class(AFrame.DataContainer,{init:function(d){this.schema=b(d.schema);d.data=a(this.schema,d.data);c.sc.init.call(this,d)},set:function(h,g,f){var e=this.checkValidity(h,g);if(true===e||f){var d=c.sc.set.call(this,h,g);if(!f){e=d}}return e},checkValidity:function(g,f){var e={};e[g]=f;var d=this.schema.validate(e,true);if(d!==true){d=d[g]}return d},serializeItems:function(){var d=this.getDataObject();return this.schema.serializeItems(d)}});return c;function b(d){var e=d instanceof AFrame.Schema?d:AFrame.Schema(d);return e}function a(f,d){if(!d){d=f.getDefaults()}var g=f.getAppData(d);for(var e in g){d[e]=g[e]}return d}})();AFrame.Event=(function(){var a=AFrame.Class({init:function(b){for(var c in b){this[c]=b[c]}if(!this.type){throw"Event type undefined"}if(this.target){this.setOriginalTarget=true}this.timestamp=new Date()},isDefaultPrevented:function(){return !!this.defaultPrevented},preventDefault:function(){this.defaultPrevented=true},proxyEvent:function(b){if(this.setOriginalTarget){this.originalTarget=this.target;this.setOriginalTarget=false}this.target=b}});a.createEvent=function(b){if(AFrame.string(b)){b={type:b}}var c=AFrame.create(AFrame.Event,b);return c};return a})();AFrame.DOM=(function(){var b=window.jQuery;var a={getElements:function(d){return b(d)},getDescendentElements:function(d,e){return b(e).find(d)},getElementsIncludeRoot:function(d,e){e=b(e);var f=e.find(d);if(e.is(d)){f=e.add(f)}return f},getChildren:function(d){return b(d).children()},getNthChild:function(d,e){return b(d).children()[e]},forEach:function(e,f,d){b(e).each(function(g,h){f.call(d,h,g)})},removeElement:function(d){b(d).remove()},bindEvent:function(e,d,f){return b(e).bind(d,f)},unbindEvent:function(e,d,f){return b(e).unbind(d,f)},fireEvent:function(d,e){return b(d).trigger(e)},setInner:function(d,e){var f=b(d);if(c(f)){f.val(e)}else{f.html(e)}},getInner:function(e){var f=b(e);var d="";if(c(f)){d=f.val()}else{d=f.html()}return d},setAttr:function(e,d,f){b(e).attr(d,f)},getAttr:function(e,d){return b(e).attr(d)},hasAttr:function(e,d){var f=b(e)[0].getAttribute(d);return f!==null},addClass:function(d,e){b(d).addClass(e)},removeClass:function(d,e){b(d).removeClass(e)},hasClass:function(d,e){return b(d).hasClass(e)},createElement:function(f,e){var d=b("<"+f+"/>");if(e){AFrame.DOM.setInner(d,e)}return d},appendTo:function(e,d){b(e).appendTo(b(d))},insertBefore:function(e,d){b(e).insertBefore(d)},insertAsNthChild:function(h,g,e){var f=b(g).children();if(e===f.length){h.appendTo(g)}else{var d=f.eq(e);h.insertBefore(d)}}};function c(d){return d.is("input")||d.is("textarea")}return a}());